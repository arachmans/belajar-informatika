<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Organisasi File - PT. Maju Sejahtera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .file-item {
            transition: all 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .file-item:hover, .file-item:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .folder-item {
            transition: all 0.2s ease;
        }
        .folder-item:hover {
            background-color: #f3f4f6;
        }
        .drop-zone {
            min-height: 40px;
            transition: all 0.2s ease;
        }
        .drop-zone.drag-over, .drop-zone.touch-over {
            background-color: #dbeafe;
            border: 2px dashed #3b82f6;
        }
        .dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .touch-dragging {
            opacity: 0.7;
            transform: scale(1.05);
            z-index: 1000;
            position: relative;
        }
        .mobile-hint {
            display: none;
        }
        @media (max-width: 768px) {
            .mobile-hint {
                display: block;
            }
            .file-item {
                padding: 12px;
                min-height: 80px;
            }
            .drop-zone {
                min-height: 50px;
                padding: 8px;
            }
            .folder-item .drop-zone {
                border: 1px dashed transparent;
            }
            .folder-item .drop-zone.touch-over {
                border: 2px dashed #3b82f6;
                background-color: #dbeafe;
            }
        }
        .touch-feedback {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üè¢ Simulasi Organisasi File Digital</h1>
                <p class="text-gray-600">Selamat datang di PT. Maju Sejahtera! Mari rapikan file-file digital ini.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Column -->
                <div class="lg:col-span-1 space-y-6">
                    <!-- Instructions Area -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h2 class="text-xl font-bold text-blue-800 mb-4">üìã Tugas Pertama Anda di PT. Maju Sejahtera!</h2>
                        <div class="text-sm text-blue-700 space-y-3">
                            <p><strong>Selamat datang di tim kami!</strong> Sebagai tugas pertama, Anda diminta untuk merapikan file-file digital yang ada di desktop bersama.</p>
                            
                            <div class="bg-white p-4 rounded border">
                                <p class="font-semibold mb-2">Tugas Anda adalah:</p>
                                <ol class="list-decimal list-inside space-y-1 text-xs">
                                    <li>Buat struktur folder yang rapi untuk menyimpan semua file ini</li>
                                    <li>Buat satu folder utama bernama <strong>"Dokumen Kantor 2023"</strong></li>
                                    <li>Di dalam Dokumen Kantor 2023, buat tiga subfolder utama:
                                        <ul class="list-disc list-inside ml-4 mt-1">
                                            <li><strong>01_Keuangan</strong></li>
                                            <li><strong>02_Pemasaran</strong></li>
                                            <li><strong>03_SDM</strong></li>
                                        </ul>
                                    </li>
                                    <li>Di dalam folder 01_Keuangan, buat lagi dua subfolder:
                                        <ul class="list-disc list-inside ml-4 mt-1">
                                            <li><strong>Faktur & Invoice</strong></li>
                                            <li><strong>Laporan Pajak</strong></li>
                                        </ul>
                                    </li>
                                    <li>Setelah struktur folder selesai, pindahkan semua 20 file yang tersedia ke dalam folder yang paling sesuai</li>
                                </ol>
                            </div>
                            
                            <p class="font-semibold text-blue-800">üéØ Selamat bekerja!</p>
                        </div>
                    </div>

                    <!-- Folder Structure Area -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">üìÅ Struktur Folder</h3>
                            <button onclick="createNewFolder()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm font-medium transition-colors">
                                + Folder Baru
                            </button>
                        </div>
                        <div id="folderStructure" class="space-y-2 min-h-[300px]">
                            <p class="text-gray-500 text-sm italic">Klik "Folder Baru" untuk mulai membuat struktur folder...</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Files Area -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">üìÑ File yang Perlu Diorganisir (20 file)</h3>
                        <div class="mobile-hint bg-blue-50 border border-blue-200 rounded p-3 mb-4">
                            <p class="text-sm text-blue-700">üì± <strong>Petunjuk HP:</strong> Tekan dan tahan file, lalu seret ke folder yang diinginkan. Lepaskan saat folder menyala biru.</p>
                        </div>
                        <div id="filesArea" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <!-- Files will be populated by JavaScript -->
                        </div>
                        
                        <div class="mt-8 text-center">
                            <button onclick="checkAnswer()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg text-lg font-semibold transition-colors shadow-md">
                                üîç Periksa Jawaban
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Touch feedback for mobile -->
    <div id="touchFeedback" class="touch-feedback"></div>

    <!-- Modal for creating folders -->
    <div id="folderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4">Buat Folder Baru</h3>
            <input type="text" id="folderNameInput" placeholder="Nama folder..." class="w-full p-3 border border-gray-300 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex justify-end space-x-3">
                <button onclick="closeFolderModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                <button onclick="confirmCreateFolder()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">Buat</button>
            </div>
        </div>
    </div>

    <!-- Modal for renaming folders -->
    <div id="renameModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4">Rename Folder</h3>
            <input type="text" id="renameInput" placeholder="Nama folder baru..." class="w-full p-3 border border-gray-300 rounded mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <div class="flex justify-end space-x-3">
                <button onclick="closeRenameModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                <button onclick="confirmRename()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">Rename</button>
            </div>
        </div>
    </div>

    <!-- Modal for delete confirmation -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <h3 class="text-lg font-semibold mb-4">Konfirmasi Hapus</h3>
            <p class="text-gray-600 mb-4">Apakah Anda yakin ingin menghapus folder ini? Semua file di dalamnya akan dikembalikan ke area file.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="closeDeleteModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Batal</button>
                <button onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 mx-4">
            <div id="resultContent"></div>
            <div class="flex justify-end mt-4">
                <button onclick="closeResultModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let folders = {};
        let currentParentId = null;
        let fileLocations = {};
        let currentRenameId = null;
        let currentDeleteId = null;
        let currentDeleteParent = null;
        
        // Touch/drag state
        let isDragging = false;
        let draggedElement = null;
        let draggedFileName = null;
        let draggedSourceFolder = null;
        let touchStartX = 0;
        let touchStartY = 0;
        let currentDropTarget = null;
        
        // File list with proper categorization
        const files = [
            { name: "Laporan_Keuangan_Q3.xlsx", icon: "üìä", category: "keuangan", subcategory: "laporan" },
            { name: "Invoice_untuk_PT_Cahaya.pdf", icon: "üßæ", category: "keuangan", subcategory: "invoice" },
            { name: "Desain_Brosur_Terbaru.ai", icon: "üé®", category: "pemasaran", subcategory: "design" },
            { name: "CV_Pelamar_Andi.pdf", icon: "üìÑ", category: "sdm", subcategory: "recruitment" },
            { name: "Bukti_Potong_PPH21_September.pdf", icon: "üßæ", category: "keuangan", subcategory: "pajak" },
            { name: "Konten_Kalender_Medsos_Oktober.docx", icon: "üìù", category: "pemasaran", subcategory: "content" },
            { name: "Data_Absensi_Karyawan.csv", icon: "üìã", category: "sdm", subcategory: "attendance" },
            { name: "Logo_Perusahaan_Resolusi_Tinggi.png", icon: "üñºÔ∏è", category: "pemasaran", subcategory: "design" },
            { name: "Faktur_Pembelian_ATK.pdf", icon: "üßæ", category: "keuangan", subcategory: "invoice" },
            { name: "Presentasi_Strategi_Marketing_Q4.pptx", icon: "üìä", category: "pemasaran", subcategory: "presentation" },
            { name: "Formulir_Klaim_Asuransi_Kesehatan.docx", icon: "üìÑ", category: "sdm", subcategory: "benefits" },
            { name: "Laporan_Pajak_Tahunan_2022.pdf", icon: "üìä", category: "keuangan", subcategory: "pajak" },
            { name: "Video_Iklan_Produk_A.mp4", icon: "üé¨", category: "pemasaran", subcategory: "video" },
            { name: "Surat_Penawaran_Kerja_Budi.pdf", icon: "üìÑ", category: "sdm", subcategory: "recruitment" },
            { name: "Invoice_dari_Vendor_Logistik.pdf", icon: "üßæ", category: "keuangan", subcategory: "invoice" },
            { name: "Riset_Kata_Kunci_SEO.xlsx", icon: "üìä", category: "pemasaran", subcategory: "research" },
            { name: "Foto_Acara_Gathering_Tim.jpg", icon: "üì∏", category: "sdm", subcategory: "events" },
            { name: "Panduan_Karyawan_Baru.pdf", icon: "üìñ", category: "sdm", subcategory: "training" },
            { name: "Tagihan_Internet_September.pdf", icon: "üßæ", category: "keuangan", subcategory: "invoice" },
            { name: "SPT_Masa_PPN_Agustus.pdf", icon: "üìä", category: "keuangan", subcategory: "pajak" }
        ];

        // Initialize the game
        function initGame() {
            renderFiles();
        }

        // Render files in the files area
        function renderFiles() {
            const filesArea = document.getElementById('filesArea');
            filesArea.innerHTML = '';
            
            files.forEach((file, index) => {
                if (!fileLocations[file.name]) {
                    const fileElement = document.createElement('div');
                    fileElement.className = 'file-item bg-gray-50 border border-gray-200 rounded-lg p-3 cursor-move hover:shadow-md';
                    fileElement.draggable = true;
                    fileElement.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">${file.icon}</div>
                            <div class="text-xs text-gray-700 break-words">${file.name}</div>
                        </div>
                    `;
                    
                    // Desktop drag events
                    fileElement.addEventListener('dragstart', (e) => {
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', file.name);
                        e.dataTransfer.setData('source-folder', '');
                        fileElement.classList.add('dragging');
                        isDragging = true;
                    });
                    
                    fileElement.addEventListener('dragend', () => {
                        fileElement.classList.remove('dragging');
                        isDragging = false;
                    });
                    
                    // Touch events for mobile
                    addTouchEvents(fileElement, file.name, null);
                    
                    filesArea.appendChild(fileElement);
                }
            });
        }

        // Create new folder
        function createNewFolder() {
            document.getElementById('folderModal').classList.remove('hidden');
            document.getElementById('folderModal').classList.add('flex');
            document.getElementById('folderNameInput').focus();
        }

        function closeFolderModal() {
            document.getElementById('folderModal').classList.add('hidden');
            document.getElementById('folderModal').classList.remove('flex');
            document.getElementById('folderNameInput').value = '';
            currentParentId = null;
        }

        function confirmCreateFolder() {
            const folderName = document.getElementById('folderNameInput').value.trim();
            if (folderName) {
                const folderId = Date.now().toString();
                const parentId = currentParentId || 'root';
                
                if (!folders[parentId]) {
                    folders[parentId] = [];
                }
                
                folders[parentId].push({
                    id: folderId,
                    name: folderName,
                    files: []
                });
                
                renderFolderStructure();
                closeFolderModal();
            }
        }

        // Render folder structure
        function renderFolderStructure() {
            const container = document.getElementById('folderStructure');
            container.innerHTML = '';
            
            if (!folders.root || folders.root.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm italic">Klik "Folder Baru" untuk mulai membuat struktur folder...</p>';
                return;
            }
            
            renderFolderLevel(container, 'root', 0);
        }

        function renderFolderLevel(container, parentId, level) {
            if (!folders[parentId]) return;
            
            folders[parentId].forEach(folder => {
                const folderElement = document.createElement('div');
                folderElement.className = 'folder-item';
                
                const indent = level * 20;
                folderElement.innerHTML = `
                    <div class="flex items-center p-2 rounded hover:bg-gray-50 drop-zone group" style="margin-left: ${indent}px;" data-folder-id="${folder.id}">
                        <span class="text-lg mr-2">üìÅ</span>
                        <span class="font-medium text-gray-800 flex-1">${folder.name}</span>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1">
                            <button onclick="createSubfolder('${folder.id}')" class="text-xs bg-green-200 hover:bg-green-300 px-2 py-1 rounded" title="Tambah Subfolder">+ Sub</button>
                            <button onclick="renameFolder('${folder.id}')" class="text-xs bg-blue-200 hover:bg-blue-300 px-2 py-1 rounded" title="Rename">‚úèÔ∏è</button>
                            <button onclick="deleteFolder('${folder.id}', '${parentId}')" class="text-xs bg-red-200 hover:bg-red-300 px-2 py-1 rounded" title="Hapus">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                
                // Add drag and drop functionality
                const dropZone = folderElement.querySelector('.drop-zone');
                
                // Desktop drag events
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    dropZone.classList.add('drag-over');
                });
                
                dropZone.addEventListener('dragleave', (e) => {
                    if (!dropZone.contains(e.relatedTarget)) {
                        dropZone.classList.remove('drag-over');
                    }
                });
                
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-over');
                    const fileName = e.dataTransfer.getData('text/plain');
                    const sourceFolder = e.dataTransfer.getData('source-folder');
                    moveFileToFolder(fileName, folder.id, sourceFolder || null);
                });
                
                // Touch events for mobile drop zones
                addDropZoneTouchEvents(dropZone, folder.id);
                
                container.appendChild(folderElement);
                
                // Show files in this folder
                if (folder.files && folder.files.length > 0) {
                    const filesContainer = document.createElement('div');
                    filesContainer.style.marginLeft = `${indent + 20}px`;
                    folder.files.forEach(fileName => {
                        const file = files.find(f => f.name === fileName);
                        if (file) {
                            const fileDiv = document.createElement('div');
                            fileDiv.className = 'flex items-center p-1 text-sm text-gray-600 hover:bg-gray-100 rounded cursor-move';
                            fileDiv.draggable = true;
                            fileDiv.innerHTML = `<span class="mr-2">${file.icon}</span><span class="flex-1">${fileName}</span><span class="text-xs text-gray-400">üìÅ</span>`;
                            
                            // Desktop drag functionality for files in folders
                            fileDiv.addEventListener('dragstart', (e) => {
                                e.dataTransfer.effectAllowed = 'move';
                                e.dataTransfer.setData('text/plain', fileName);
                                e.dataTransfer.setData('source-folder', folder.id);
                                fileDiv.classList.add('dragging');
                                isDragging = true;
                            });
                            
                            fileDiv.addEventListener('dragend', () => {
                                fileDiv.classList.remove('dragging');
                                isDragging = false;
                            });
                            
                            // Touch events for files in folders
                            addTouchEvents(fileDiv, fileName, folder.id);
                            
                            filesContainer.appendChild(fileDiv);
                        }
                    });
                    container.appendChild(filesContainer);
                }
                
                // Render subfolders
                renderFolderLevel(container, folder.id, level + 1);
            });
        }

        function createSubfolder(parentId) {
            currentParentId = parentId;
            createNewFolder();
        }

        function moveFileToFolder(fileName, folderId, sourceFolderId = null) {
            // Remove file from its current location
            if (sourceFolderId) {
                const sourceFolder = findFolderById(sourceFolderId);
                if (sourceFolder) {
                    const fileIndex = sourceFolder.files.indexOf(fileName);
                    if (fileIndex > -1) {
                        sourceFolder.files.splice(fileIndex, 1);
                    }
                }
            } else {
                // Remove from any folder it might be in
                Object.keys(folders).forEach(parentId => {
                    if (folders[parentId]) {
                        folders[parentId].forEach(folder => {
                            const fileIndex = folder.files.indexOf(fileName);
                            if (fileIndex > -1) {
                                folder.files.splice(fileIndex, 1);
                            }
                        });
                    }
                });
            }
            
            // Add file to new folder
            const targetFolder = findFolderById(folderId);
            if (targetFolder && !targetFolder.files.includes(fileName)) {
                targetFolder.files.push(fileName);
                fileLocations[fileName] = folderId;
            }
            
            renderFiles();
            renderFolderStructure();
        }

        function findFolderById(folderId) {
            for (let parentId in folders) {
                const folder = folders[parentId].find(f => f.id === folderId);
                if (folder) return folder;
            }
            return null;
        }

        // Check answer function
        function checkAnswer() {
            let score = 0;
            let feedback = [];
            
            // Check folder structure
            const mainFolder = folders.root?.find(f => f.name === "Dokumen Kantor 2023");
            if (mainFolder) {
                score += 10;
                feedback.push("‚úÖ Folder utama 'Dokumen Kantor 2023' sudah dibuat");
                
                const subfolders = folders[mainFolder.id] || [];
                const requiredSubfolders = ["01_Keuangan", "02_Pemasaran", "03_SDM"];
                
                requiredSubfolders.forEach(reqFolder => {
                    if (subfolders.find(f => f.name === reqFolder)) {
                        score += 10;
                        feedback.push(`‚úÖ Subfolder '${reqFolder}' sudah dibuat`);
                    } else {
                        feedback.push(`‚ùå Subfolder '${reqFolder}' belum dibuat`);
                    }
                });
                
                // Check Keuangan subfolders
                const keuanganFolder = subfolders.find(f => f.name === "01_Keuangan");
                if (keuanganFolder) {
                    const keuanganSubs = folders[keuanganFolder.id] || [];
                    const requiredKeuanganSubs = ["Faktur & Invoice", "Laporan Pajak"];
                    
                    requiredKeuanganSubs.forEach(reqSub => {
                        if (keuanganSubs.find(f => f.name === reqSub)) {
                            score += 10;
                            feedback.push(`‚úÖ Subfolder '${reqSub}' sudah dibuat`);
                        } else {
                            feedback.push(`‚ùå Subfolder '${reqSub}' belum dibuat`);
                        }
                    });
                }
            } else {
                feedback.push("‚ùå Folder utama 'Dokumen Kantor 2023' belum dibuat");
            }
            
            // Check file placement
            let correctFiles = 0;
            files.forEach(file => {
                const correctLocation = getCorrectLocation(file, mainFolder);
                const currentLocation = fileLocations[file.name];
                
                if (currentLocation && correctLocation && currentLocation === correctLocation) {
                    correctFiles++;
                }
            });
            
            score += correctFiles * 2;
            
            // Show results
            const totalScore = Math.min(100, score);
            let resultHTML = `
                <h3 class="text-xl font-bold mb-4">üìä Hasil Penilaian</h3>
                <div class="mb-4">
                    <div class="text-3xl font-bold text-center ${totalScore >= 80 ? 'text-green-600' : totalScore >= 60 ? 'text-yellow-600' : 'text-red-600'}">${totalScore}/100</div>
                    <div class="text-center text-gray-600">File yang benar: ${correctFiles}/20</div>
                </div>
                <div class="space-y-2 max-h-60 overflow-y-auto">
            `;
            
            feedback.forEach(item => {
                resultHTML += `<div class="text-sm">${item}</div>`;
            });
            
            resultHTML += '</div>';
            
            if (totalScore >= 80) {
                resultHTML += '<div class="mt-4 p-3 bg-green-100 text-green-800 rounded">üéâ Selamat! Anda berhasil menyelesaikan tugas dengan baik!</div>';
            } else if (totalScore >= 60) {
                resultHTML += '<div class="mt-4 p-3 bg-yellow-100 text-yellow-800 rounded">üëç Cukup baik! Masih ada beberapa yang perlu diperbaiki.</div>';
            } else {
                resultHTML += '<div class="mt-4 p-3 bg-red-100 text-red-800 rounded">üí™ Jangan menyerah! Coba lagi dan perhatikan instruksi dengan teliti.</div>';
            }
            
            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('resultModal').classList.remove('hidden');
            document.getElementById('resultModal').classList.add('flex');
        }

        function getCorrectLocation(file, mainFolder) {
            if (!mainFolder) return null;
            
            const subfolders = folders[mainFolder.id] || [];
            
            if (file.category === 'keuangan') {
                const keuanganFolder = subfolders.find(f => f.name === "01_Keuangan");
                if (keuanganFolder) {
                    const keuanganSubs = folders[keuanganFolder.id] || [];
                    if (file.subcategory === 'invoice') {
                        const invoiceFolder = keuanganSubs.find(f => f.name === "Faktur & Invoice");
                        return invoiceFolder?.id;
                    } else if (file.subcategory === 'pajak') {
                        const pajakFolder = keuanganSubs.find(f => f.name === "Laporan Pajak");
                        return pajakFolder?.id;
                    }
                    return keuanganFolder.id;
                }
            } else if (file.category === 'pemasaran') {
                const pemasaranFolder = subfolders.find(f => f.name === "02_Pemasaran");
                return pemasaranFolder?.id;
            } else if (file.category === 'sdm') {
                const sdmFolder = subfolders.find(f => f.name === "03_SDM");
                return sdmFolder?.id;
            }
            
            return null;
        }

        function closeResultModal() {
            document.getElementById('resultModal').classList.add('hidden');
            document.getElementById('resultModal').classList.remove('flex');
        }

        // Rename folder functions
        function renameFolder(folderId) {
            const folder = findFolderById(folderId);
            if (folder) {
                currentRenameId = folderId;
                document.getElementById('renameInput').value = folder.name;
                document.getElementById('renameModal').classList.remove('hidden');
                document.getElementById('renameModal').classList.add('flex');
                document.getElementById('renameInput').focus();
                document.getElementById('renameInput').select();
            }
        }

        function closeRenameModal() {
            document.getElementById('renameModal').classList.add('hidden');
            document.getElementById('renameModal').classList.remove('flex');
            document.getElementById('renameInput').value = '';
            currentRenameId = null;
        }

        function confirmRename() {
            const newName = document.getElementById('renameInput').value.trim();
            if (newName && currentRenameId) {
                const folder = findFolderById(currentRenameId);
                if (folder) {
                    folder.name = newName;
                    renderFolderStructure();
                }
                closeRenameModal();
            }
        }

        // Delete folder functions
        function deleteFolder(folderId, parentId) {
            currentDeleteId = folderId;
            currentDeleteParent = parentId;
            document.getElementById('deleteModal').classList.remove('hidden');
            document.getElementById('deleteModal').classList.add('flex');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            document.getElementById('deleteModal').classList.remove('flex');
            currentDeleteId = null;
            currentDeleteParent = null;
        }

        function confirmDelete() {
            if (currentDeleteId && currentDeleteParent) {
                const folder = findFolderById(currentDeleteId);
                if (folder) {
                    // Return all files to the main files area
                    folder.files.forEach(fileName => {
                        delete fileLocations[fileName];
                    });
                    
                    // Also handle subfolders recursively
                    returnAllFilesFromSubfolders(currentDeleteId);
                    
                    // Remove folder from parent
                    const parentFolders = folders[currentDeleteParent];
                    if (parentFolders) {
                        const folderIndex = parentFolders.findIndex(f => f.id === currentDeleteId);
                        if (folderIndex > -1) {
                            parentFolders.splice(folderIndex, 1);
                        }
                    }
                    
                    // Remove any subfolders
                    delete folders[currentDeleteId];
                    
                    renderFiles();
                    renderFolderStructure();
                }
                closeDeleteModal();
            }
        }

        function returnAllFilesFromSubfolders(folderId) {
            if (folders[folderId]) {
                folders[folderId].forEach(subfolder => {
                    // Return files from this subfolder
                    subfolder.files.forEach(fileName => {
                        delete fileLocations[fileName];
                    });
                    
                    // Recursively handle sub-subfolders
                    returnAllFilesFromSubfolders(subfolder.id);
                });
                
                // Delete the subfolder structure
                delete folders[folderId];
            }
        }

        // Handle Enter key in inputs
        document.getElementById('folderNameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                confirmCreateFolder();
            }
        });

        document.getElementById('renameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                confirmRename();
            }
        });

        // Touch event handlers for mobile drag and drop
        function addTouchEvents(element, fileName, sourceFolderId) {
            let touchStartTime = 0;
            let longPressTimer = null;
            let hasMoved = false;
            
            element.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
                hasMoved = false;
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                
                // Start long press timer
                longPressTimer = setTimeout(() => {
                    if (!hasMoved) {
                        startTouchDrag(element, fileName, sourceFolderId, touch);
                    }
                }, 500); // 500ms for long press
                
                e.preventDefault();
            }, { passive: false });
            
            element.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const deltaX = Math.abs(touch.clientX - touchStartX);
                const deltaY = Math.abs(touch.clientY - touchStartY);
                
                if (deltaX > 10 || deltaY > 10) {
                    hasMoved = true;
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                }
                
                if (isDragging && draggedElement === element) {
                    handleTouchMove(e);
                }
                
                e.preventDefault();
            }, { passive: false });
            
            element.addEventListener('touchend', (e) => {
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }
                
                if (isDragging && draggedElement === element) {
                    handleTouchEnd(e);
                }
                
                e.preventDefault();
            }, { passive: false });
        }
        
        function addDropZoneTouchEvents(dropZone, folderId) {
            dropZone.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                    
                    if (dropZone.contains(elementBelow) || elementBelow === dropZone) {
                        if (currentDropTarget !== dropZone) {
                            // Remove highlight from previous target
                            if (currentDropTarget) {
                                currentDropTarget.classList.remove('touch-over');
                            }
                            // Add highlight to new target
                            dropZone.classList.add('touch-over');
                            currentDropTarget = dropZone;
                            showTouchFeedback('Lepaskan untuk memasukkan ke folder');
                        }
                    }
                }
            }, { passive: true });
        }
        
        function startTouchDrag(element, fileName, sourceFolderId, touch) {
            isDragging = true;
            draggedElement = element;
            draggedFileName = fileName;
            draggedSourceFolder = sourceFolderId;
            
            element.classList.add('touch-dragging');
            showTouchFeedback('Seret ke folder tujuan');
            
            // Add vibration feedback if available
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        function handleTouchMove(e) {
            const touch = e.touches[0];
            
            // Clear previous drop target highlights
            document.querySelectorAll('.touch-over').forEach(el => {
                el.classList.remove('touch-over');
            });
            
            // Find element under touch point
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const dropZone = elementBelow?.closest('.drop-zone');
            
            if (dropZone && dropZone !== currentDropTarget) {
                if (currentDropTarget) {
                    currentDropTarget.classList.remove('touch-over');
                }
                dropZone.classList.add('touch-over');
                currentDropTarget = dropZone;
                showTouchFeedback('Lepaskan untuk memasukkan ke folder');
            } else if (!dropZone && currentDropTarget) {
                currentDropTarget.classList.remove('touch-over');
                currentDropTarget = null;
                showTouchFeedback('Seret ke folder tujuan');
            }
        }
        
        function handleTouchEnd(e) {
            if (currentDropTarget) {
                const folderId = currentDropTarget.getAttribute('data-folder-id');
                if (folderId && draggedFileName) {
                    moveFileToFolder(draggedFileName, folderId, draggedSourceFolder);
                    showTouchFeedback('File berhasil dipindahkan!');
                    
                    // Success vibration
                    if (navigator.vibrate) {
                        navigator.vibrate([50, 50, 50]);
                    }
                }
                currentDropTarget.classList.remove('touch-over');
                currentDropTarget = null;
            } else {
                showTouchFeedback('Pemindahan dibatalkan');
            }
            
            // Clean up
            if (draggedElement) {
                draggedElement.classList.remove('touch-dragging');
            }
            
            isDragging = false;
            draggedElement = null;
            draggedFileName = null;
            draggedSourceFolder = null;
            
            // Hide feedback after delay
            setTimeout(hideTouchFeedback, 2000);
        }
        
        function showTouchFeedback(message) {
            const feedback = document.getElementById('touchFeedback');
            feedback.textContent = message;
            feedback.style.display = 'block';
        }
        
        function hideTouchFeedback() {
            const feedback = document.getElementById('touchFeedback');
            feedback.style.display = 'none';
        }
        
        // Prevent default touch behaviors that might interfere
        document.addEventListener('touchmove', (e) => {
            if (isDragging) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchstart', (e) => {
            if (isDragging) {
                e.preventDefault();
            }
        }, { passive: false });

        // Initialize game when page loads
        initGame();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978c0ced03d237b5',t:'MTc1NjgwNjA3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
