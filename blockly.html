
<form method="POST" action="/submit">
  <!-- konten form -->
</form>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Belajar HTML dengan Blockly</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .btn-gradient {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .block-item {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .block-item:hover {
            background: #f8fafc;
            border-left-color: #667eea;
            transform: translateX(5px);
        }
        
        .code-display {
            background: #1a202c;
            color: #68d391;
            font-family: 'Fira Code', 'Courier New', monospace;
        }
        
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .workspace-container {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white p-6">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold mb-2">üß© Belajar HTML dengan Blockly</h1>
            <p class="text-blue-100">Buat halaman web dengan menyusun blok visual</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="h-screen flex flex-col overflow-hidden">
        <!-- Action Bar -->
        <div class="bg-white border-b border-gray-200 px-3 md:px-6 py-3 md:py-4 flex flex-col sm:flex-row justify-between items-center gap-3 sm:gap-0 flex-shrink-0">
            <div class="flex items-center space-x-2 md:space-x-4">
                <button onclick="showBlocksPopup()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium transition-colors flex items-center text-sm md:text-base">
                    <span class="mr-1 md:mr-2">‚ûï</span>Tambah Blok
                </button>
                <button onclick="showQuickActions()" class="bg-green-500 hover:bg-green-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium transition-colors flex items-center text-sm md:text-base">
                    <span class="mr-1 md:mr-2">‚ö°</span>Quick
                </button>
            </div>
            <div class="flex items-center space-x-2 md:space-x-4">
                <button onclick="runCode()" class="btn-gradient text-white px-4 md:px-6 py-2 rounded-lg font-medium flex items-center text-sm md:text-base">
                    <span class="mr-1 md:mr-2">‚ñ∂Ô∏è</span>Run
                </button>
                <button onclick="clearWorkspace()" class="bg-red-500 hover:bg-red-600 text-white px-3 md:px-4 py-2 rounded-lg font-medium transition-colors text-sm md:text-base">
                    üóëÔ∏è Clear
                </button>
            </div>
        </div>

        <!-- Workspace -->
        <div class="flex-1 p-3 md:p-6 overflow-hidden">
            <div class="bg-white rounded-xl card-shadow h-full overflow-hidden">
                <div id="blocklyDiv" class="workspace-container h-full"></div>
            </div>
        </div>
    </div>

    <!-- Blocks Popup -->
    <div id="blocksPopup" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                        <span class="mr-2">üß∞</span>Pilih Blok HTML
                    </h2>
                    <button onclick="hideBlocksPopup()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                <!-- Search -->
                <div class="mt-4">
                    <input type="text" id="blockSearch" placeholder="üîç Cari blok..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           oninput="filterBlocks()">
                </div>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[70vh]">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Struktur Dasar -->
                    <div class="block-category bg-blue-50 p-4 rounded-lg" data-category="struktur">
                        <h3 class="text-lg font-semibold text-blue-700 mb-3 flex items-center">
                            <span class="mr-2">üìÑ</span>Struktur
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-100 transition-colors border border-blue-200" 
                                 data-block="html_document" data-name="html document struktur"
                                 onclick="addBlockAndClose('html_document')">
                                <div class="text-2xl mb-1">üìÑ</div>
                                <div class="text-sm font-medium">HTML Document</div>
                                <div class="text-xs text-gray-600">Dokumen HTML utama</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-100 transition-colors border border-blue-200" 
                                 data-block="html_head" data-name="head kepala"
                                 onclick="addBlockAndClose('html_head')">
                                <div class="text-2xl mb-1">üß†</div>
                                <div class="text-sm font-medium">Head</div>
                                <div class="text-xs text-gray-600">Bagian head HTML</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-100 transition-colors border border-blue-200" 
                                 data-block="html_body" data-name="body tubuh"
                                 onclick="addBlockAndClose('html_body')">
                                <div class="text-2xl mb-1">üë§</div>
                                <div class="text-sm font-medium">Body</div>
                                <div class="text-xs text-gray-600">Bagian body HTML</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-blue-100 transition-colors border border-blue-200" 
                                 data-block="html_title" data-name="title judul"
                                 onclick="addBlockAndClose('html_title')">
                                <div class="text-2xl mb-1">üè∑Ô∏è</div>
                                <div class="text-sm font-medium">Title</div>
                                <div class="text-xs text-gray-600">Judul halaman</div>
                            </div>
                        </div>
                    </div>

                    <!-- Teks -->
                    <div class="block-category bg-green-50 p-4 rounded-lg" data-category="teks">
                        <h3 class="text-lg font-semibold text-green-700 mb-3 flex items-center">
                            <span class="mr-2">üìù</span>Teks
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-green-100 transition-colors border border-green-200" 
                                 data-block="html_heading" data-name="heading judul h1 h2 h3 h4 h5 h6"
                                 onclick="addBlockAndClose('html_heading')">
                                <div class="text-2xl mb-1">üì¢</div>
                                <div class="text-sm font-medium">Heading</div>
                                <div class="text-xs text-gray-600">H1-H6</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-green-100 transition-colors border border-green-200" 
                                 data-block="html_p" data-name="paragraf teks"
                                 onclick="addBlockAndClose('html_p')">
                                <div class="text-2xl mb-1">üìù</div>
                                <div class="text-sm font-medium">Paragraf</div>
                                <div class="text-xs text-gray-600">Teks paragraf</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-green-100 transition-colors border border-green-200" 
                                 data-block="html_strong" data-name="strong tebal"
                                 onclick="addBlockAndClose('html_strong')">
                                <div class="text-2xl mb-1">üí™</div>
                                <div class="text-sm font-medium">Strong</div>
                                <div class="text-xs text-gray-600">Teks tebal</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-green-100 transition-colors border border-green-200" 
                                 data-block="html_em" data-name="em miring italic"
                                 onclick="addBlockAndClose('html_em')">
                                <div class="text-2xl mb-1">üìù</div>
                                <div class="text-sm font-medium">Em</div>
                                <div class="text-xs text-gray-600">Teks miring</div>
                            </div>
                        </div>
                    </div>

                    <!-- Link & Media -->
                    <div class="block-category bg-red-50 p-4 rounded-lg" data-category="media">
                        <h3 class="text-lg font-semibold text-red-700 mb-3 flex items-center">
                            <span class="mr-2">üîó</span>Link & Media
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-red-200" 
                                 data-block="html_a" data-name="link tautan"
                                 onclick="addBlockAndClose('html_a')">
                                <div class="text-2xl mb-1">üîó</div>
                                <div class="text-sm font-medium">Link</div>
                                <div class="text-xs text-gray-600">Tautan</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-red-200" 
                                 data-block="html_img" data-name="gambar image"
                                 onclick="addBlockAndClose('html_img')">
                                <div class="text-2xl mb-1">üñºÔ∏è</div>
                                <div class="text-sm font-medium">Gambar</div>
                                <div class="text-xs text-gray-600">Image</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-red-200" 
                                 data-block="html_br" data-name="break baris"
                                 onclick="addBlockAndClose('html_br')">
                                <div class="text-2xl mb-1">‚Ü©Ô∏è</div>
                                <div class="text-sm font-medium">Line Break</div>
                                <div class="text-xs text-gray-600">Baris baru</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-red-100 transition-colors border border-red-200" 
                                 data-block="html_hr" data-name="hr horizontal rule garis"
                                 onclick="addBlockAndClose('html_hr')">
                                <div class="text-2xl mb-1">‚ûñ</div>
                                <div class="text-sm font-medium">HR</div>
                                <div class="text-xs text-gray-600">Garis horizontal</div>
                            </div>
                        </div>
                    </div>

                    <!-- Audio & Video -->
                    <div class="block-category bg-orange-50 p-4 rounded-lg" data-category="multimedia">
                        <h3 class="text-lg font-semibold text-orange-700 mb-3 flex items-center">
                            <span class="mr-2">üéµ</span>Audio & Video
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 transition-colors border border-orange-200" 
                                 data-block="html_audio" data-name="audio musik suara"
                                 onclick="addBlockAndClose('html_audio')">
                                <div class="text-2xl mb-1">üéµ</div>
                                <div class="text-sm font-medium">Audio</div>
                                <div class="text-xs text-gray-600">Player audio</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 transition-colors border border-orange-200" 
                                 data-block="html_video" data-name="video film"
                                 onclick="addBlockAndClose('html_video')">
                                <div class="text-2xl mb-1">üé¨</div>
                                <div class="text-sm font-medium">Video</div>
                                <div class="text-xs text-gray-600">Player video</div>
                            </div>
                        </div>
                    </div>

                    <!-- List -->
                    <div class="block-category bg-yellow-50 p-4 rounded-lg" data-category="list">
                        <h3 class="text-lg font-semibold text-yellow-700 mb-3 flex items-center">
                            <span class="mr-2">üìã</span>List
                        </h3>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-yellow-100 transition-colors border border-yellow-200" 
                                 data-block="html_ul" data-name="unordered list daftar"
                                 onclick="addBlockAndClose('html_ul')">
                                <div class="text-2xl mb-1">üî∏</div>
                                <div class="text-sm font-medium">UL</div>
                                <div class="text-xs text-gray-600">Unordered List</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-yellow-100 transition-colors border border-yellow-200" 
                                 data-block="html_ol" data-name="ordered list nomor"
                                 onclick="addBlockAndClose('html_ol')">
                                <div class="text-2xl mb-1">üî¢</div>
                                <div class="text-sm font-medium">OL</div>
                                <div class="text-xs text-gray-600">Ordered List</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-yellow-100 transition-colors border border-yellow-200" 
                                 data-block="html_li" data-name="list item"
                                 onclick="addBlockAndClose('html_li')">
                                <div class="text-2xl mb-1">‚Ä¢</div>
                                <div class="text-sm font-medium">LI</div>
                                <div class="text-xs text-gray-600">List Item</div>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="block-category bg-indigo-50 p-4 rounded-lg" data-category="table">
                        <h3 class="text-lg font-semibold text-indigo-700 mb-3 flex items-center">
                            <span class="mr-2">üìä</span>Table
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors border border-indigo-200" 
                                 data-block="html_table" data-name="table tabel"
                                 onclick="addBlockAndClose('html_table')">
                                <div class="text-2xl mb-1">üìä</div>
                                <div class="text-sm font-medium">Table</div>
                                <div class="text-xs text-gray-600">Tabel</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors border border-indigo-200" 
                                 data-block="html_tr" data-name="table row baris"
                                 onclick="addBlockAndClose('html_tr')">
                                <div class="text-2xl mb-1">üìè</div>
                                <div class="text-sm font-medium">TR</div>
                                <div class="text-xs text-gray-600">Table Row</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors border border-indigo-200" 
                                 data-block="html_th" data-name="table header kepala"
                                 onclick="addBlockAndClose('html_th')">
                                <div class="text-2xl mb-1">üè∑Ô∏è</div>
                                <div class="text-sm font-medium">TH</div>
                                <div class="text-xs text-gray-600">Table Header</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-indigo-100 transition-colors border border-indigo-200" 
                                 data-block="html_td" data-name="table data sel"
                                 onclick="addBlockAndClose('html_td')">
                                <div class="text-2xl mb-1">üìã</div>
                                <div class="text-sm font-medium">TD</div>
                                <div class="text-xs text-gray-600">Table Data</div>
                            </div>
                        </div>
                    </div>

                    <!-- Form -->
                    <div class="block-category bg-pink-50 p-4 rounded-lg" data-category="form">
                        <h3 class="text-lg font-semibold text-pink-700 mb-3 flex items-center">
                            <span class="mr-2">üìù</span>Form
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_form" data-name="form formulir"
                                 onclick="addBlockAndClose('html_form')">
                                <div class="text-2xl mb-1">üìù</div>
                                <div class="text-sm font-medium">Form</div>
                                <div class="text-xs text-gray-600">Formulir</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_label" data-name="label nama"
                                 onclick="addBlockAndClose('html_label')">
                                <div class="text-2xl mb-1">üè∑Ô∏è</div>
                                <div class="text-sm font-medium">Label</div>
                                <div class="text-xs text-gray-600">Label input</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_input" data-name="input masukan"
                                 onclick="addBlockAndClose('html_input')">
                                <div class="text-2xl mb-1">‚å®Ô∏è</div>
                                <div class="text-sm font-medium">Input</div>
                                <div class="text-xs text-gray-600">Input field</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_textarea" data-name="textarea area teks"
                                 onclick="addBlockAndClose('html_textarea')">
                                <div class="text-2xl mb-1">üìÑ</div>
                                <div class="text-sm font-medium">Textarea</div>
                                <div class="text-xs text-gray-600">Area teks</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_select" data-name="select pilihan dropdown"
                                 onclick="addBlockAndClose('html_select')">
                                <div class="text-2xl mb-1">üìã</div>
                                <div class="text-sm font-medium">Select</div>
                                <div class="text-xs text-gray-600">Dropdown</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_option" data-name="option pilihan"
                                 onclick="addBlockAndClose('html_option')">
                                <div class="text-2xl mb-1">‚Ä¢</div>
                                <div class="text-sm font-medium">Option</div>
                                <div class="text-xs text-gray-600">Pilihan</div>
                            </div>
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-pink-100 transition-colors border border-pink-200" 
                                 data-block="html_button" data-name="button tombol"
                                 onclick="addBlockAndClose('html_button')">
                                <div class="text-2xl mb-1">üîò</div>
                                <div class="text-sm font-medium">Button</div>
                                <div class="text-xs text-gray-600">Tombol</div>
                            </div>
                        </div>
                    </div>

                    <!-- Container -->
                    <div class="block-category bg-purple-50 p-4 rounded-lg" data-category="container">
                        <h3 class="text-lg font-semibold text-purple-700 mb-3 flex items-center">
                            <span class="mr-2">üì¶</span>Container
                        </h3>
                        <div class="grid grid-cols-1 gap-2">
                            <div class="block-item p-3 bg-white rounded-lg cursor-pointer hover:bg-purple-100 transition-colors border border-purple-200" 
                                 data-block="html_div" data-name="div container"
                                 onclick="addBlockAndClose('html_div')">
                                <div class="text-2xl mb-1">üì¶</div>
                                <div class="text-sm font-medium">Div</div>
                                <div class="text-xs text-gray-600">Container div</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Popup -->
    <div id="quickActionsPopup" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-xl max-w-2xl w-full mx-4">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                        <span class="mr-2">‚ö°</span>Quick Actions
                    </h2>
                    <button onclick="hideQuickActions()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="loadBasicHTML()" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors text-left">
                        <div class="text-3xl mb-2">üèóÔ∏è</div>
                        <div class="font-medium text-blue-800">Struktur HTML Dasar</div>
                        <div class="text-sm text-blue-600 mt-1">HTML, Head, Body, Title, Heading, Paragraf</div>
                    </button>
                    <button onclick="loadFormExample()" class="p-4 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200 transition-colors text-left">
                        <div class="text-3xl mb-2">üìù</div>
                        <div class="font-medium text-green-800">Contoh Form</div>
                        <div class="text-sm text-green-600 mt-1">Form kontak dengan input dan textarea</div>
                    </button>
                    <button onclick="loadTableExample()" class="p-4 bg-yellow-50 hover:bg-yellow-100 rounded-lg border border-yellow-200 transition-colors text-left">
                        <div class="text-3xl mb-2">üìä</div>
                        <div class="font-medium text-yellow-800">Contoh Tabel</div>
                        <div class="text-sm text-yellow-600 mt-1">Tabel data siswa dengan header</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Output Fullscreen -->
    <div id="outputFullscreen" class="fixed inset-0 bg-white z-50 hidden">
        <div class="h-full flex flex-col">
            <!-- Header -->
            <div class="bg-gray-800 text-white p-4 flex justify-between items-center">
                <h2 class="text-xl font-semibold flex items-center">
                    <span class="mr-2">üöÄ</span>HTML Output
                </h2>
                <div class="flex items-center space-x-4">
                    <button onclick="copyCodeFullscreen()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg font-medium transition-colors">
                        üìã Copy Code
                    </button>
                    <button onclick="hideOutputFullscreen()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg font-medium transition-colors">
                        ‚úï Close
                    </button>
                </div>
            </div>
            
            <!-- Content -->
            <div class="flex-1 flex flex-col md:flex-row">
                <!-- Code Panel -->
                <div class="w-full md:w-1/2 h-1/2 md:h-full border-b md:border-b-0 md:border-r border-gray-300">
                    <div class="h-full flex flex-col">
                        <div class="bg-gray-100 px-4 py-2 border-b border-gray-300">
                            <h3 class="font-medium text-gray-700">üíª HTML Code</h3>
                        </div>
                        <div class="flex-1 overflow-auto">
                            <div class="code-display h-full p-4">
                                <pre id="codeOutputFullscreen" class="text-sm whitespace-pre-wrap h-full"></pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Preview Panel -->
                <div class="w-full md:w-1/2 h-1/2 md:h-full">
                    <div class="h-full flex flex-col">
                        <div class="bg-gray-100 px-4 py-2 border-b border-gray-300">
                            <h3 class="font-medium text-gray-700">üëÄ Preview</h3>
                        </div>
                        <div class="flex-1">
                            <iframe id="previewFullscreen" class="w-full h-full border-0"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workspace;

        // Initialize Blockly workspace
        function initBlockly() {
            workspace = Blockly.inject('blocklyDiv', {
                grid: {
                    spacing: 20,
                    length: 3,
                    colour: '#ccc',
                    snap: true
                },
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                trashcan: true,
                scrollbars: true,
                horizontalLayout: false,
                toolboxPosition: 'start'
            });
        }

        // Define custom HTML blocks
        function defineBlocks() {
            // HTML Document block
            Blockly.Blocks['html_document'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìÑ <html>");
                    this.appendStatementInput("CONTENT")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</html>");
                    this.setColour(230);
                    this.setTooltip("Dokumen HTML utama");
                }
            };

            // Head block
            Blockly.Blocks['html_head'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üß† <head>");
                    this.appendStatementInput("CONTENT")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</head>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("Bagian head HTML");
                }
            };

            // Body block
            Blockly.Blocks['html_body'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üë§ <body>");
                    this.appendStatementInput("CONTENT")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</body>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("Bagian body HTML");
                }
            };

            // Title block
            Blockly.Blocks['html_title'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üè∑Ô∏è <title>")
                        .appendField(new Blockly.FieldTextInput("Judul Halaman"), "TEXT")
                        .appendField("</title>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("Judul halaman web");
                }
            };

            // Heading block with dropdown
            Blockly.Blocks['html_heading'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üì¢")
                        .appendField(new Blockly.FieldDropdown([
                            ["<h1>", "h1"],
                            ["<h2>", "h2"],
                            ["<h3>", "h3"],
                            ["<h4>", "h4"],
                            ["<h5>", "h5"],
                            ["<h6>", "h6"]
                        ]), "LEVEL")
                        .appendField(new Blockly.FieldTextInput("Judul Heading"), "TEXT")
                        .appendField("</h1>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("Heading dengan level yang dapat dipilih");
                }
            };

            // Paragraph block
            Blockly.Blocks['html_p'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìù <p>")
                        .appendField(new Blockly.FieldTextInput("Teks paragraf"), "TEXT")
                        .appendField("</p>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("Paragraf teks");
                }
            };

            // Strong block
            Blockly.Blocks['html_strong'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üí™ <strong>")
                        .appendField(new Blockly.FieldTextInput("teks tebal"), "TEXT")
                        .appendField("</strong>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("Teks tebal/penting");
                }
            };

            // Em block
            Blockly.Blocks['html_em'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìù <em>")
                        .appendField(new Blockly.FieldTextInput("teks miring"), "TEXT")
                        .appendField("</em>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("Teks miring/penekanan");
                }
            };

            // Link block
            Blockly.Blocks['html_a'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üîó <a href=")
                        .appendField(new Blockly.FieldTextInput("https://example.com"), "HREF")
                        .appendField(">")
                        .appendField(new Blockly.FieldTextInput("Teks Link"), "TEXT")
                        .appendField("</a>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(0);
                    this.setTooltip("Link/tautan");
                }
            };

            // Image block
            Blockly.Blocks['html_img'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üñºÔ∏è <img");
                    this.appendDummyInput()
                        .appendField("src=")
                        .appendField(new Blockly.FieldTextInput("https://picsum.photos/300/200"), "SRC");
                    this.appendDummyInput()
                        .appendField("alt=")
                        .appendField(new Blockly.FieldTextInput("Deskripsi gambar"), "ALT");
                    this.appendDummyInput()
                        .appendField("width=")
                        .appendField(new Blockly.FieldTextInput("300"), "WIDTH")
                        .appendField("height=")
                        .appendField(new Blockly.FieldTextInput("200"), "HEIGHT")
                        .appendField(">");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(0);
                    this.setTooltip("Gambar dengan atribut lengkap");
                }
            };

            // Break block
            Blockly.Blocks['html_br'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("‚Ü©Ô∏è <br>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(0);
                    this.setTooltip("Baris baru");
                }
            };

            // Horizontal Rule block
            Blockly.Blocks['html_hr'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("‚ûñ <hr>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(0);
                    this.setTooltip("Garis horizontal pemisah");
                }
            };

            // Audio block
            Blockly.Blocks['html_audio'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üéµ <audio");
                    this.appendDummyInput()
                        .appendField("src=")
                        .appendField(new Blockly.FieldTextInput("https://www.soundjay.com/misc/sounds/bell-ringing-05.wav"), "SRC");
                    this.appendDummyInput()
                        .appendField("controls=")
                        .appendField(new Blockly.FieldCheckbox("TRUE"), "CONTROLS")
                        .appendField("autoplay=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "AUTOPLAY");
                    this.appendDummyInput()
                        .appendField("loop=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "LOOP")
                        .appendField("muted=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "MUTED")
                        .appendField(">");
                    this.appendDummyInput()
                        .appendField("</audio>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(30);
                    this.setTooltip("Audio player dengan kontrol lengkap");
                }
            };

            // Video block
            Blockly.Blocks['html_video'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üé¨ <video");
                    this.appendDummyInput()
                        .appendField("src=")
                        .appendField(new Blockly.FieldTextInput("https://www.w3schools.com/html/mov_bbb.mp4"), "SRC");
                    this.appendDummyInput()
                        .appendField("width=")
                        .appendField(new Blockly.FieldTextInput("400"), "WIDTH")
                        .appendField("height=")
                        .appendField(new Blockly.FieldTextInput("300"), "HEIGHT");
                    this.appendDummyInput()
                        .appendField("controls=")
                        .appendField(new Blockly.FieldCheckbox("TRUE"), "CONTROLS")
                        .appendField("autoplay=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "AUTOPLAY");
                    this.appendDummyInput()
                        .appendField("loop=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "LOOP")
                        .appendField("muted=")
                        .appendField(new Blockly.FieldCheckbox("FALSE"), "MUTED")
                        .appendField(">");
                    this.appendDummyInput()
                        .appendField("</video>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(30);
                    this.setTooltip("Video player dengan kontrol lengkap");
                }
            };

            // List blocks
            Blockly.Blocks['html_ul'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üî∏ <ul type=")
                        .appendField(new Blockly.FieldDropdown([
                            ["disc", "disc"],
                            ["circle", "circle"],
                            ["square", "square"],
                            ["none", "none"]
                        ]), "TYPE")
                        .appendField(">");
                    this.appendStatementInput("ITEMS")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</ul>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("List tidak berurutan dengan pilihan tipe bullet");
                }
            };

            Blockly.Blocks['html_ol'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üî¢ <ol type=")
                        .appendField(new Blockly.FieldDropdown([
                            ["1, 2, 3", "1"],
                            ["A, B, C", "A"],
                            ["a, b, c", "a"],
                            ["I, II, III", "I"],
                            ["i, ii, iii", "i"]
                        ]), "TYPE")
                        .appendField(">");
                    this.appendStatementInput("ITEMS")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</ol>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("List berurutan dengan pilihan tipe penomoran");
                }
            };

            Blockly.Blocks['html_li'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("‚Ä¢ <li>")
                        .appendField(new Blockly.FieldTextInput("Item list"), "TEXT")
                        .appendField("</li>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("Item dalam list");
                }
            };

            // Table blocks
            Blockly.Blocks['html_table'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìä <table>");
                    this.appendStatementInput("ROWS")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</table>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("Tabel HTML");
                }
            };

            Blockly.Blocks['html_tr'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìè <tr>");
                    this.appendStatementInput("CELLS")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</tr>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("Baris tabel");
                }
            };

            Blockly.Blocks['html_th'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üè∑Ô∏è <th");
                    this.appendDummyInput()
                        .appendField("colspan=")
                        .appendField(new Blockly.FieldNumber(1, 1, 10, 1), "COLSPAN")
                        .appendField("rowspan=")
                        .appendField(new Blockly.FieldNumber(1, 1, 10, 1), "ROWSPAN")
                        .appendField(">");
                    this.appendDummyInput()
                        .appendField(new Blockly.FieldTextInput("Header"), "TEXT")
                        .appendField("</th>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("Header tabel dengan colspan dan rowspan");
                }
            };

            Blockly.Blocks['html_td'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìã <td");
                    this.appendDummyInput()
                        .appendField("colspan=")
                        .appendField(new Blockly.FieldNumber(1, 1, 10, 1), "COLSPAN")
                        .appendField("rowspan=")
                        .appendField(new Blockly.FieldNumber(1, 1, 10, 1), "ROWSPAN")
                        .appendField(">");
                    this.appendDummyInput()
                        .appendField(new Blockly.FieldTextInput("Data"), "TEXT")
                        .appendField("</td>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("Data tabel dengan colspan dan rowspan");
                }
            };

            // Form blocks
            Blockly.Blocks['html_form'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìù <form");
                    this.appendDummyInput()
                        .appendField("method=")
                        .appendField(new Blockly.FieldDropdown([
                            ["GET", "GET"],
                            ["POST", "POST"]
                        ]), "METHOD");
                    this.appendDummyInput()
                        .appendField("action=")
                        .appendField(new Blockly.FieldTextInput("#"), "ACTION")
                        .appendField(">");
                    this.appendStatementInput("CONTENT")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</form>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Form HTML dengan method dan action");
                }
            };

            Blockly.Blocks['html_label'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üè∑Ô∏è <label for=")
                        .appendField(new Blockly.FieldTextInput("input-id"), "FOR")
                        .appendField(">")
                        .appendField(new Blockly.FieldTextInput("Label"), "TEXT")
                        .appendField("</label>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Label untuk input");
                }
            };

            Blockly.Blocks['html_input'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("‚å®Ô∏è <input type=")
                        .appendField(new Blockly.FieldDropdown([
                            ["text", "text"],
                            ["email", "email"],
                            ["password", "password"],
                            ["number", "number"],
                            ["date", "date"],
                            ["time", "time"],
                            ["checkbox", "checkbox"],
                            ["radio", "radio"],
                            ["submit", "submit"]
                        ]), "TYPE")
                        .appendField("name=")
                        .appendField(new Blockly.FieldTextInput("input-name"), "NAME")
                        .appendField(">");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Input field");
                }
            };

            Blockly.Blocks['html_textarea'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìÑ <textarea")
                    this.appendDummyInput()
                        .appendField("name=")
                        .appendField(new Blockly.FieldTextInput("textarea-name"), "NAME")
                        .appendField("placeholder=")
                        .appendField(new Blockly.FieldTextInput("Masukkan teks..."), "PLACEHOLDER")
                        .appendField(">");
                    this.appendDummyInput()
                        .appendField("</textarea>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Area teks multi-baris");
                }
            };

            Blockly.Blocks['html_select'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üìã <select name=")
                        .appendField(new Blockly.FieldTextInput("select-name"), "NAME")
                        .appendField(">");
                    this.appendStatementInput("OPTIONS")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</select>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Dropdown select");
                }
            };

            Blockly.Blocks['html_option'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("‚Ä¢ <option value=")
                        .appendField(new Blockly.FieldTextInput("value"), "VALUE")
                        .appendField(">")
                        .appendField(new Blockly.FieldTextInput("Pilihan"), "TEXT")
                        .appendField("</option>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Opsi dalam select");
                }
            };

            Blockly.Blocks['html_button'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üîò <button type=")
                        .appendField(new Blockly.FieldDropdown([
                            ["button", "button"],
                            ["submit", "submit"],
                            ["reset", "reset"]
                        ]), "TYPE")
                        .appendField(">")
                        .appendField(new Blockly.FieldTextInput("Klik Saya"), "TEXT")
                        .appendField("</button>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("Tombol");
                }
            };

            // Container blocks
            Blockly.Blocks['html_div'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("üì¶ <div>");
                    this.appendStatementInput("CONTENT")
                        .setCheck(null);
                    this.appendDummyInput()
                        .appendField("</div>");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(290);
                    this.setTooltip("Container div");
                }
            };
        }

        // Define code generators
        function defineGenerators() {
            const htmlGenerator = {
                statementToCode: function(block, name) {
                    const targetBlock = block.getInputTargetBlock(name);
                    if (!targetBlock) return '';
                    
                    let code = '';
                    let currentBlock = targetBlock;
                    const processedBlocks = new Set();
                    
                    while (currentBlock && !processedBlocks.has(currentBlock.id)) {
                        processedBlocks.add(currentBlock.id);
                        code += this.generateBlockCode(currentBlock);
                        currentBlock = currentBlock.getNextBlock();
                    }
                    
                    return code;
                },

                generateBlockCode: function(block) {
                    const blockType = block.type;
                    
                    switch(blockType) {
                        case 'html_document':
                            const docContent = this.getStatementContent(block, 'CONTENT');
                            return `<!DOCTYPE html>\n<html>\n${docContent}</html>`;
                        
                        case 'html_head':
                            const headContent = this.getStatementContent(block, 'CONTENT');
                            return `<head>\n${headContent}</head>\n`;
                        
                        case 'html_body':
                            const bodyContent = this.getStatementContent(block, 'CONTENT');
                            return `<body>\n${bodyContent}</body>\n`;
                        
                        case 'html_title':
                            const titleText = block.getFieldValue('TEXT') || 'Untitled';
                            return `<title>${titleText}</title>\n`;
                        
                        case 'html_heading':
                            const headingLevel = block.getFieldValue('LEVEL') || 'h1';
                            const headingText = block.getFieldValue('TEXT') || 'Heading';
                            return `<${headingLevel}>${headingText}</${headingLevel}>\n`;
                        
                        case 'html_p':
                            const pText = block.getFieldValue('TEXT') || 'Paragraph';
                            return `<p>${pText}</p>\n`;
                        
                        case 'html_strong':
                            const strongText = block.getFieldValue('TEXT') || 'Strong';
                            return `<strong>${strongText}</strong>\n`;
                        
                        case 'html_em':
                            const emText = block.getFieldValue('TEXT') || 'Em';
                            return `<em>${emText}</em>\n`;
                        
                        case 'html_a':
                            const linkText = block.getFieldValue('TEXT') || 'Link';
                            const href = block.getFieldValue('HREF') || '#';
                            return `<a href="${href}">${linkText}</a>\n`;
                        
                        case 'html_img':
                            const imgSrc = block.getFieldValue('SRC') || 'https://picsum.photos/300/200';
                            const alt = block.getFieldValue('ALT') || 'Image';
                            const width = block.getFieldValue('WIDTH') || '300';
                            const height = block.getFieldValue('HEIGHT') || '200';
                            return `<img src="${imgSrc}" alt="${alt}" width="${width}" height="${height}">\n`;
                        
                        case 'html_br':
                            return '<br>\n';
                        
                        case 'html_hr':
                            return '<hr>\n';
                        
                        case 'html_audio':
                            const audioSrc = block.getFieldValue('SRC') || '';
                            const audioControls = block.getFieldValue('CONTROLS') === 'TRUE' ? ' controls' : '';
                            const audioAutoplay = block.getFieldValue('AUTOPLAY') === 'TRUE' ? ' autoplay' : '';
                            const audioLoop = block.getFieldValue('LOOP') === 'TRUE' ? ' loop' : '';
                            const audioMuted = block.getFieldValue('MUTED') === 'TRUE' ? ' muted' : '';
                            return `<audio src="${audioSrc}"${audioControls}${audioAutoplay}${audioLoop}${audioMuted}>\n  Browser Anda tidak mendukung audio.\n</audio>\n`;
                        
                        case 'html_video':
                            const videoSrc = block.getFieldValue('SRC') || '';
                            const videoWidth = block.getFieldValue('WIDTH') || '400';
                            const videoHeight = block.getFieldValue('HEIGHT') || '300';
                            const videoControls = block.getFieldValue('CONTROLS') === 'TRUE' ? ' controls' : '';
                            const videoAutoplay = block.getFieldValue('AUTOPLAY') === 'TRUE' ? ' autoplay' : '';
                            const videoLoop = block.getFieldValue('LOOP') === 'TRUE' ? ' loop' : '';
                            const videoMuted = block.getFieldValue('MUTED') === 'TRUE' ? ' muted' : '';
                            return `<video src="${videoSrc}" width="${videoWidth}" height="${videoHeight}"${videoControls}${videoAutoplay}${videoLoop}${videoMuted}>\n  Browser Anda tidak mendukung video.\n</video>\n`;
                        
                        case 'html_ul':
                            const ulItems = this.getStatementContent(block, 'ITEMS');
                            const ulType = block.getFieldValue('TYPE') || 'disc';
                            return `<ul type="${ulType}" style="list-style-type: ${ulType};">\n${ulItems}</ul>\n`;
                        
                        case 'html_ol':
                            const olItems = this.getStatementContent(block, 'ITEMS');
                            const olType = block.getFieldValue('TYPE') || '1';
                            return `<ol type="${olType}">\n${olItems}</ol>\n`;
                        
                        case 'html_li':
                            const liText = block.getFieldValue('TEXT') || 'List item';
                            return `<li>${liText}</li>\n`;
                        
                        case 'html_div':
                            const divContent = this.getStatementContent(block, 'CONTENT');
                            return `<div>\n${divContent}</div>\n`;
                        
                        case 'html_table':
                            const tableRows = this.getStatementContent(block, 'ROWS');
                            return `<table border="1" style="border-collapse: collapse; width: 100%;">\n${tableRows}</table>\n`;
                        
                        case 'html_tr':
                            const tableCells = this.getStatementContent(block, 'CELLS');
                            return `<tr>\n${tableCells}</tr>\n`;
                        
                        case 'html_th':
                            const thText = block.getFieldValue('TEXT') || 'Header';
                            const thColspan = block.getFieldValue('COLSPAN') || 1;
                            const thRowspan = block.getFieldValue('ROWSPAN') || 1;
                            let thAttributes = 'style="padding: 8px; background-color: #f2f2f2;"';
                            if (thColspan > 1) thAttributes += ` colspan="${thColspan}"`;
                            if (thRowspan > 1) thAttributes += ` rowspan="${thRowspan}"`;
                            return `<th ${thAttributes}>${thText}</th>\n`;
                        
                        case 'html_td':
                            const tdText = block.getFieldValue('TEXT') || 'Data';
                            const tdColspan = block.getFieldValue('COLSPAN') || 1;
                            const tdRowspan = block.getFieldValue('ROWSPAN') || 1;
                            let tdAttributes = 'style="padding: 8px;"';
                            if (tdColspan > 1) tdAttributes += ` colspan="${tdColspan}"`;
                            if (tdRowspan > 1) tdAttributes += ` rowspan="${tdRowspan}"`;
                            return `<td ${tdAttributes}>${tdText}</td>\n`;
                        
                        case 'html_form':
                            const formContent = this.getStatementContent(block, 'CONTENT');
                            const formMethod = block.getFieldValue('METHOD') || 'GET';
                            const formAction = block.getFieldValue('ACTION') || '#';
                            return `<form method="${formMethod}" action="${formAction}">\n${formContent}</form>\n`;
                        
                        case 'html_label':
                            const labelText = block.getFieldValue('TEXT') || 'Label';
                            const labelFor = block.getFieldValue('FOR') || '';
                            return `<label for="${labelFor}">${labelText}</label>\n`;
                        
                        case 'html_input':
                            const inputType = block.getFieldValue('TYPE') || 'text';
                            const inputName = block.getFieldValue('NAME') || 'input';
                            return `<input type="${inputType}" name="${inputName}" id="${inputName}">\n`;
                        
                        case 'html_textarea':
                            const textareaName = block.getFieldValue('NAME') || 'textarea';
                            const placeholder = block.getFieldValue('PLACEHOLDER') || '';
                            return `<textarea name="${textareaName}" id="${textareaName}" placeholder="${placeholder}" rows="4" cols="50"></textarea>\n`;
                        
                        case 'html_select':
                            const selectName = block.getFieldValue('NAME') || 'select';
                            const selectOptions = this.getStatementContent(block, 'OPTIONS');
                            return `<select name="${selectName}" id="${selectName}">\n${selectOptions}</select>\n`;
                        
                        case 'html_option':
                            const optionText = block.getFieldValue('TEXT') || 'Option';
                            const optionValue = block.getFieldValue('VALUE') || '';
                            return `<option value="${optionValue}">${optionText}</option>\n`;
                        
                        case 'html_button':
                            const buttonText = block.getFieldValue('TEXT') || 'Button';
                            const buttonType = block.getFieldValue('TYPE') || 'button';
                            return `<button type="${buttonType}">${buttonText}</button>\n`;
                        
                        default:
                            return `<!-- Unknown block: ${blockType} -->\n`;
                    }
                },

                getStatementContent: function(block, inputName) {
                    const targetBlock = block.getInputTargetBlock(inputName);
                    if (!targetBlock) return '';
                    
                    let content = '';
                    let currentBlock = targetBlock;
                    const processedBlocks = new Set();
                    
                    while (currentBlock && !processedBlocks.has(currentBlock.id)) {
                        processedBlocks.add(currentBlock.id);
                        content += this.generateBlockCode(currentBlock);
                        currentBlock = currentBlock.getNextBlock();
                    }
                    
                    return content;
                },

                workspaceToCode: function(workspace) {
                    const topBlocks = workspace.getTopBlocks(true);
                    let code = '';
                    
                    for (let block of topBlocks) {
                        try {
                            code += this.generateBlockCode(block);
                        } catch (e) {
                            console.error(`Error processing block ${block.type}:`, e);
                            code += `<!-- Error in ${block.type} -->\n`;
                        }
                    }
                    
                    return code;
                }
            };

            window.htmlGenerator = htmlGenerator;
        }

        // Show blocks popup
        function showBlocksPopup() {
            document.getElementById('blocksPopup').classList.remove('hidden');
            document.getElementById('blockSearch').focus();
        }

        // Hide blocks popup
        function hideBlocksPopup() {
            document.getElementById('blocksPopup').classList.add('hidden');
            document.getElementById('blockSearch').value = '';
            filterBlocks(); // Reset filter
        }

        // Show quick actions popup
        function showQuickActions() {
            document.getElementById('quickActionsPopup').classList.remove('hidden');
        }

        // Hide quick actions popup
        function hideQuickActions() {
            document.getElementById('quickActionsPopup').classList.add('hidden');
        }

        // Show output fullscreen
        function showOutputFullscreen() {
            const code = window.htmlGenerator ? window.htmlGenerator.workspaceToCode(workspace) : '';
            
            document.getElementById('outputFullscreen').classList.remove('hidden');
            document.getElementById('codeOutputFullscreen').textContent = code;
            
            // Update fullscreen preview
            const previewFullscreen = document.getElementById('previewFullscreen');
            const previewDoc = previewFullscreen.contentDocument || previewFullscreen.contentWindow.document;
            previewDoc.open();
            
            if (code && code.trim()) {
                const styledCode = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>
                        body {
                            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 20px;
                            background: #f8fafc;
                        }
                        h1, h2, h3, h4, h5, h6 {
                            color: #2d3748;
                            margin-top: 1.5em;
                            margin-bottom: 0.5em;
                            font-weight: 600;
                        }
                        h1 {
                            font-size: 2.25em;
                            border-bottom: 3px solid #667eea;
                            padding-bottom: 0.3em;
                        }
                        h2 {
                            font-size: 1.875em;
                            color: #4a5568;
                        }
                        h3 {
                            font-size: 1.5em;
                            color: #4a5568;
                        }
                        h4 {
                            font-size: 1.25em;
                            color: #4a5568;
                        }
                        h5 {
                            font-size: 1.125em;
                            color: #4a5568;
                        }
                        h6 {
                            font-size: 1em;
                            color: #4a5568;
                            font-weight: 600;
                        }
                        p {
                            margin-bottom: 1em;
                            text-align: justify;
                        }
                        strong {
                            color: #2b6cb0;
                            font-weight: 600;
                        }
                        em {
                            color: #805ad5;
                            font-style: italic;
                        }
                        a {
                            color: #667eea;
                            text-decoration: none;
                            border-bottom: 1px solid transparent;
                            transition: all 0.3s ease;
                        }
                        a:hover {
                            color: #5a67d8;
                            border-bottom-color: #5a67d8;
                        }
                        img {
                            max-width: 100%;
                            height: auto;
                            border-radius: 8px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            margin: 1em 0;
                        }
                        audio {
                            width: 100%;
                            margin: 1em 0;
                            border-radius: 8px;
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }
                        video {
                            max-width: 100%;
                            height: auto;
                            border-radius: 8px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            margin: 1em 0;
                            background: #000;
                        }
                        ul, ol {
                            margin: 1em 0;
                            padding-left: 2em;
                        }
                        li {
                            margin-bottom: 0.5em;
                            color: #4a5568;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 1.5em 0;
                            background: white;
                            border-radius: 8px;
                            overflow: hidden;
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }
                        th {
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            padding: 12px 15px;
                            text-align: left;
                            font-weight: 600;
                        }
                        td {
                            padding: 12px 15px;
                            border-bottom: 1px solid #e2e8f0;
                        }
                        tr:hover {
                            background-color: #f7fafc;
                        }
                        form {
                            background: white;
                            padding: 2em;
                            border-radius: 12px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            margin: 1.5em 0;
                        }
                        label {
                            display: block;
                            margin-bottom: 0.5em;
                            font-weight: 500;
                            color: #4a5568;
                        }
                        input, textarea, select {
                            width: 100%;
                            padding: 0.75em;
                            border: 2px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 1em;
                            transition: border-color 0.3s ease;
                            margin-bottom: 1em;
                            box-sizing: border-box;
                        }
                        input:focus, textarea:focus, select:focus {
                            outline: none;
                            border-color: #667eea;
                            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                        }
                        button {
                            background: linear-gradient(45deg, #667eea, #764ba2);
                            color: white;
                            padding: 0.75em 1.5em;
                            border: none;
                            border-radius: 6px;
                            font-size: 1em;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        }
                        button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                        }
                        div {
                            margin: 1em 0;
                        }
                        br {
                            line-height: 2;
                        }
                        hr {
                            border: none;
                            height: 2px;
                            background: linear-gradient(90deg, transparent, #667eea, transparent);
                            margin: 2em 0;
                            border-radius: 1px;
                        }
                    </style>
                </head>
                <body>
                    ${code.replace(/<!DOCTYPE html>[\s\S]*?<body[^>]*>/i, '').replace(/<\/body>[\s\S]*?<\/html>/i, '')}
                </body>
                </html>`;
                
                previewDoc.write(styledCode);
            } else {
                previewDoc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <style>
                            body {
                                font-family: 'Inter', sans-serif;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                height: 100vh;
                                margin: 0;
                                background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                                color: #666;
                            }
                            .message {
                                text-align: center;
                                padding: 2em;
                                background: white;
                                border-radius: 12px;
                                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            }
                        </style>
                    </head>
                    <body>
                        <div class="message">
                            <h3>üé® Preview Area</h3>
                            <p>Susun blok untuk melihat preview halaman web</p>
                        </div>
                    </body>
                    </html>
                `);
            }
            
            previewDoc.close();
        }

        // Hide output fullscreen
        function hideOutputFullscreen() {
            document.getElementById('outputFullscreen').classList.add('hidden');
        }

        // Copy code from fullscreen
        function copyCodeFullscreen() {
            const code = document.getElementById('codeOutputFullscreen').textContent;
            
            // Try modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(code).then(() => {
                    showNotification('üìã Kode HTML berhasil disalin!', 'success');
                }).catch(() => {
                    // Fallback to older method
                    fallbackCopyTextToClipboard(code);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(code);
            }
        }

        // Fallback copy function for older browsers
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // Avoid scrolling to bottom
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('üìã Kode HTML berhasil disalin!', 'success');
                } else {
                    showNotification('‚ùå Gagal menyalin kode', 'error');
                }
            } catch (err) {
                showNotification('‚ùå Browser tidak mendukung copy otomatis', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // Run code (renamed from generateCode)
        function runCode() {
            showOutputFullscreen();
        }

        // Add block and close popup
        function addBlockAndClose(blockType) {
            addBlock(blockType);
            hideBlocksPopup();
        }

        // Generate HTML code from blocks
        function generateCode() {
            try {
                const code = window.htmlGenerator ? window.htmlGenerator.workspaceToCode(workspace) : '';
                const codeOutput = document.getElementById('codeOutput');
                const preview = document.getElementById('preview');
                
                if (code && code.trim()) {
                    codeOutput.textContent = code;
                    
                    const previewDoc = preview.contentDocument || preview.contentWindow.document;
                    previewDoc.open();
                    
                    // Add CSS styling to preview
                    const styledCode = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <style>
                            body {
                                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                                line-height: 1.6;
                                color: #333;
                                max-width: 800px;
                                margin: 0 auto;
                                padding: 20px;
                                background: #f8fafc;
                            }
                            h1, h2, h3, h4, h5, h6 {
                                color: #2d3748;
                                margin-top: 1.5em;
                                margin-bottom: 0.5em;
                                font-weight: 600;
                            }
                            h1 {
                                font-size: 2.25em;
                                border-bottom: 3px solid #667eea;
                                padding-bottom: 0.3em;
                            }
                            h2 {
                                font-size: 1.875em;
                                color: #4a5568;
                            }
                            h3 {
                                font-size: 1.5em;
                                color: #4a5568;
                            }
                            h4 {
                                font-size: 1.25em;
                                color: #4a5568;
                            }
                            h5 {
                                font-size: 1.125em;
                                color: #4a5568;
                            }
                            h6 {
                                font-size: 1em;
                                color: #4a5568;
                                font-weight: 600;
                            }
                            p {
                                margin-bottom: 1em;
                                text-align: justify;
                            }
                            strong {
                                color: #2b6cb0;
                                font-weight: 600;
                            }
                            em {
                                color: #805ad5;
                                font-style: italic;
                            }
                            a {
                                color: #667eea;
                                text-decoration: none;
                                border-bottom: 1px solid transparent;
                                transition: all 0.3s ease;
                            }
                            a:hover {
                                color: #5a67d8;
                                border-bottom-color: #5a67d8;
                            }
                            img {
                                max-width: 100%;
                                height: auto;
                                border-radius: 8px;
                                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                margin: 1em 0;
                            }
                            audio {
                                width: 100%;
                                margin: 1em 0;
                                border-radius: 8px;
                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                            }
                            video {
                                max-width: 100%;
                                height: auto;
                                border-radius: 8px;
                                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                margin: 1em 0;
                                background: #000;
                            }
                            ul, ol {
                                margin: 1em 0;
                                padding-left: 2em;
                            }
                            li {
                                margin-bottom: 0.5em;
                                color: #4a5568;
                            }
                            ul[style*="disc"] li {
                                list-style-type: disc;
                            }
                            ul[style*="circle"] li {
                                list-style-type: circle;
                            }
                            ul[style*="square"] li {
                                list-style-type: square;
                            }
                            ul[style*="none"] li {
                                list-style-type: none;
                            }
                            ol[type="1"] li {
                                list-style-type: decimal;
                            }
                            ol[type="A"] li {
                                list-style-type: upper-alpha;
                            }
                            ol[type="a"] li {
                                list-style-type: lower-alpha;
                            }
                            ol[type="I"] li {
                                list-style-type: upper-roman;
                            }
                            ol[type="i"] li {
                                list-style-type: lower-roman;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                margin: 1.5em 0;
                                background: white;
                                border-radius: 8px;
                                overflow: hidden;
                                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                            }
                            th {
                                background: linear-gradient(135deg, #667eea, #764ba2);
                                color: white;
                                padding: 12px 15px;
                                text-align: left;
                                font-weight: 600;
                            }
                            td {
                                padding: 12px 15px;
                                border-bottom: 1px solid #e2e8f0;
                            }
                            tr:hover {
                                background-color: #f7fafc;
                            }
                            form {
                                background: white;
                                padding: 2em;
                                border-radius: 12px;
                                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                margin: 1.5em 0;
                            }
                            label {
                                display: block;
                                margin-bottom: 0.5em;
                                font-weight: 500;
                                color: #4a5568;
                            }
                            input, textarea, select {
                                width: 100%;
                                padding: 0.75em;
                                border: 2px solid #e2e8f0;
                                border-radius: 6px;
                                font-size: 1em;
                                transition: border-color 0.3s ease;
                                margin-bottom: 1em;
                                box-sizing: border-box;
                            }
                            input:focus, textarea:focus, select:focus {
                                outline: none;
                                border-color: #667eea;
                                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                            }
                            button {
                                background: linear-gradient(45deg, #667eea, #764ba2);
                                color: white;
                                padding: 0.75em 1.5em;
                                border: none;
                                border-radius: 6px;
                                font-size: 1em;
                                font-weight: 500;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            }
                            button:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                            }
                            div {
                                margin: 1em 0;
                            }
                            br {
                                line-height: 2;
                            }
                            hr {
                                border: none;
                                height: 2px;
                                background: linear-gradient(90deg, transparent, #667eea, transparent);
                                margin: 2em 0;
                                border-radius: 1px;
                            }
                        </style>
                    </head>
                    <body>
                        ${code.replace(/<!DOCTYPE html>[\s\S]*?<body[^>]*>/i, '').replace(/<\/body>[\s\S]*?<\/html>/i, '')}
                    </body>
                    </html>`;
                    
                    previewDoc.write(styledCode);
                    previewDoc.close();
                    
                    showNotification('‚úÖ HTML berhasil di-generate!', 'success');
                } else {
                    codeOutput.textContent = '<!-- Belum ada blok yang disusun -->';
                    const previewDoc = preview.contentDocument || preview.contentWindow.document;
                    previewDoc.open();
                    previewDoc.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <style>
                                body {
                                    font-family: 'Inter', sans-serif;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    height: 100vh;
                                    margin: 0;
                                    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                                    color: #666;
                                }
                                .message {
                                    text-align: center;
                                    padding: 2em;
                                    background: white;
                                    border-radius: 12px;
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                }
                            </style>
                        </head>
                        <body>
                            <div class="message">
                                <h3>üé® Preview Area</h3>
                                <p>Susun blok untuk melihat preview halaman web</p>
                            </div>
                        </body>
                        </html>
                    `);
                    previewDoc.close();
                }
            } catch (error) {
                console.error('Error generating code:', error);
                showNotification('‚ùå Error saat generate HTML', 'error');
            }
        }

        // Add block function
        function addBlock(blockType) {
            const block = workspace.newBlock(blockType);
            block.initSvg();
            block.render();
            
            // Find the bottom-most block and its position
            const allBlocks = workspace.getAllBlocks();
            let bottomY = 50; // Default starting position
            let bottomX = 50; // Default starting position
            
            if (allBlocks.length > 1) { // More than just the new block
                let bottomMostBlock = null;
                let lowestY = -Infinity;
                
                allBlocks.forEach(existingBlock => {
                    if (existingBlock !== block) { // Don't include the new block itself
                        const blockBounds = existingBlock.getBoundingRectangle();
                        const blockBottom = blockBounds.bottom;
                        if (blockBottom > lowestY) {
                            lowestY = blockBottom;
                            bottomMostBlock = existingBlock;
                        }
                    }
                });
                
                if (bottomMostBlock) {
                    const bottomBlockBounds = bottomMostBlock.getBoundingRectangle();
                    bottomX = bottomBlockBounds.left; // Use the same X position as the bottom-most block
                    bottomY = bottomBlockBounds.bottom + 10; // Small gap below the bottom-most block
                }
            }
            
            block.moveBy(bottomX, bottomY);
            
            // Scroll to show the new block if it's outside the visible area
            workspace.centerOnBlock(block.id);
            
            showNotification(`‚úÖ Blok ${blockType.replace('html_', '').toUpperCase()} ditambahkan!`, 'success');
        }

        // Clear workspace
        function clearWorkspace() {
            workspace.clear();
            document.getElementById('codeOutput').textContent = '<!-- Workspace dikosongkan -->';
            const preview = document.getElementById('preview');
            const previewDoc = preview.contentDocument || preview.contentWindow.document;
            previewDoc.open();
            previewDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <style>
                        body {
                            font-family: 'Inter', sans-serif;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            height: 100vh;
                            margin: 0;
                            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                            color: #666;
                        }
                        .message {
                            text-align: center;
                            padding: 2em;
                            background: white;
                            border-radius: 12px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                        }
                    </style>
                </head>
                <body>
                    <div class="message">
                        <h3>üóëÔ∏è Workspace Dikosongkan</h3>
                        <p>Mulai susun blok baru untuk membuat halaman web</p>
                    </div>
                </body>
                </html>
            `);
            previewDoc.close();
            showNotification('üóëÔ∏è Workspace berhasil dikosongkan!', 'info');
        }

        // Load basic HTML structure
        function loadBasicHTML() {
            hideQuickActions();
            workspace.clear();
            
            setTimeout(() => {
                try {
                    // Create HTML document block
                    const docBlock = workspace.newBlock('html_document');
                    docBlock.initSvg();
                    docBlock.render();
                    docBlock.moveBy(50, 50);
                    
                    // Create head block
                    const headBlock = workspace.newBlock('html_head');
                    headBlock.initSvg();
                    headBlock.render();
                    
                    // Create title block
                    const titleBlock = workspace.newBlock('html_title');
                    titleBlock.initSvg();
                    titleBlock.render();
                    titleBlock.setFieldValue('Halaman Web Saya', 'TEXT');
                    
                    // Create body block
                    const bodyBlock = workspace.newBlock('html_body');
                    bodyBlock.initSvg();
                    bodyBlock.render();
                    
                    // Create heading block
                    const headingBlock = workspace.newBlock('html_heading');
                    headingBlock.initSvg();
                    headingBlock.render();
                    headingBlock.setFieldValue('h1', 'LEVEL');
                    headingBlock.setFieldValue('Selamat Datang!', 'TEXT');
                    
                    // Create paragraph block
                    const paragraphBlock = workspace.newBlock('html_p');
                    paragraphBlock.initSvg();
                    paragraphBlock.render();
                    paragraphBlock.setFieldValue('Ini adalah halaman web pertama saya yang dibuat dengan Blockly.', 'TEXT');
                    
                    // Position blocks properly
                    headBlock.moveBy(20, 100);
                    titleBlock.moveBy(40, 170);
                    bodyBlock.moveBy(20, 240);
                    headingBlock.moveBy(40, 310);
                    paragraphBlock.moveBy(40, 380);
                    
                    // Connect blocks with proper error handling
                    setTimeout(() => {
                        try {
                            if (docBlock.getInput('CONTENT') && headBlock.previousConnection) {
                                docBlock.getInput('CONTENT').connection.connect(headBlock.previousConnection);
                            }
                            if (headBlock.getInput('CONTENT') && titleBlock.previousConnection) {
                                headBlock.getInput('CONTENT').connection.connect(titleBlock.previousConnection);
                            }
                            if (headBlock.nextConnection && bodyBlock.previousConnection) {
                                headBlock.nextConnection.connect(bodyBlock.previousConnection);
                            }
                            if (bodyBlock.getInput('CONTENT') && headingBlock.previousConnection) {
                                bodyBlock.getInput('CONTENT').connection.connect(headingBlock.previousConnection);
                            }
                            if (headingBlock.nextConnection && paragraphBlock.previousConnection) {
                                headingBlock.nextConnection.connect(paragraphBlock.previousConnection);
                            }
                        } catch (e) {
                            console.log('Connection error:', e);
                        }
                        
                        workspace.render();
                        showNotification('üèóÔ∏è Struktur HTML dasar berhasil dimuat!', 'success');
                    }, 50);
                    
                } catch (error) {
                    console.error('Error creating blocks:', error);
                    showNotification('‚ùå Error saat membuat blok', 'error');
                }
            }, 200);
        }

        // Load form example
        function loadFormExample() {
            hideQuickActions();
            workspace.clear();
            
            setTimeout(() => {
                try {
                    // Create blocks
                    const docBlock = workspace.newBlock('html_document');
                    docBlock.initSvg();
                    docBlock.render();
                    docBlock.moveBy(50, 50);
                    
                    const headBlock = workspace.newBlock('html_head');
                    headBlock.initSvg();
                    headBlock.render();
                    
                    const titleBlock = workspace.newBlock('html_title');
                    titleBlock.initSvg();
                    titleBlock.render();
                    titleBlock.setFieldValue('Form Kontak', 'TEXT');
                    
                    const bodyBlock = workspace.newBlock('html_body');
                    bodyBlock.initSvg();
                    bodyBlock.render();
                    
                    const headingBlock = workspace.newBlock('html_heading');
                    headingBlock.initSvg();
                    headingBlock.render();
                    headingBlock.setFieldValue('h2', 'LEVEL');
                    headingBlock.setFieldValue('Hubungi Kami', 'TEXT');
                    
                    const formBlock = workspace.newBlock('html_form');
                    formBlock.initSvg();
                    formBlock.render();
                    
                    const nameLabel = workspace.newBlock('html_label');
                    nameLabel.initSvg();
                    nameLabel.render();
                    nameLabel.setFieldValue('Nama:', 'TEXT');
                    nameLabel.setFieldValue('nama', 'FOR');
                    
                    const nameInput = workspace.newBlock('html_input');
                    nameInput.initSvg();
                    nameInput.render();
                    nameInput.setFieldValue('text', 'TYPE');
                    nameInput.setFieldValue('nama', 'NAME');
                    
                    const emailLabel = workspace.newBlock('html_label');
                    emailLabel.initSvg();
                    emailLabel.render();
                    emailLabel.setFieldValue('Email:', 'TEXT');
                    emailLabel.setFieldValue('email', 'FOR');
                    
                    const emailInput = workspace.newBlock('html_input');
                    emailInput.initSvg();
                    emailInput.render();
                    emailInput.setFieldValue('email', 'TYPE');
                    emailInput.setFieldValue('email', 'NAME');
                    
                    const messageLabel = workspace.newBlock('html_label');
                    messageLabel.initSvg();
                    messageLabel.render();
                    messageLabel.setFieldValue('Pesan:', 'TEXT');
                    messageLabel.setFieldValue('pesan', 'FOR');
                    
                    const textarea = workspace.newBlock('html_textarea');
                    textarea.initSvg();
                    textarea.render();
                    textarea.setFieldValue('pesan', 'NAME');
                    textarea.setFieldValue('Tulis pesan Anda di sini...', 'PLACEHOLDER');
                    
                    const submitButton = workspace.newBlock('html_button');
                    submitButton.initSvg();
                    submitButton.render();
                    submitButton.setFieldValue('Kirim Pesan', 'TEXT');
                    submitButton.setFieldValue('submit', 'TYPE');
                    
                    // Position blocks
                    headBlock.moveBy(20, 100);
                    titleBlock.moveBy(40, 170);
                    bodyBlock.moveBy(20, 240);
                    headingBlock.moveBy(40, 310);
                    formBlock.moveBy(40, 380);
                    nameLabel.moveBy(60, 450);
                    nameInput.moveBy(60, 520);
                    emailLabel.moveBy(60, 590);
                    emailInput.moveBy(60, 660);
                    messageLabel.moveBy(60, 730);
                    textarea.moveBy(60, 800);
                    submitButton.moveBy(60, 870);
                    
                    // Connect blocks with delay
                    setTimeout(() => {
                        try {
                            if (docBlock.getInput('CONTENT') && headBlock.previousConnection) {
                                docBlock.getInput('CONTENT').connection.connect(headBlock.previousConnection);
                            }
                            if (headBlock.getInput('CONTENT') && titleBlock.previousConnection) {
                                headBlock.getInput('CONTENT').connection.connect(titleBlock.previousConnection);
                            }
                            if (headBlock.nextConnection && bodyBlock.previousConnection) {
                                headBlock.nextConnection.connect(bodyBlock.previousConnection);
                            }
                            if (bodyBlock.getInput('CONTENT') && headingBlock.previousConnection) {
                                bodyBlock.getInput('CONTENT').connection.connect(headingBlock.previousConnection);
                            }
                            if (headingBlock.nextConnection && formBlock.previousConnection) {
                                headingBlock.nextConnection.connect(formBlock.previousConnection);
                            }
                            if (formBlock.getInput('CONTENT') && nameLabel.previousConnection) {
                                formBlock.getInput('CONTENT').connection.connect(nameLabel.previousConnection);
                            }
                            if (nameLabel.nextConnection && nameInput.previousConnection) {
                                nameLabel.nextConnection.connect(nameInput.previousConnection);
                            }
                            if (nameInput.nextConnection && emailLabel.previousConnection) {
                                nameInput.nextConnection.connect(emailLabel.previousConnection);
                            }
                            if (emailLabel.nextConnection && emailInput.previousConnection) {
                                emailLabel.nextConnection.connect(emailInput.previousConnection);
                            }
                            if (emailInput.nextConnection && messageLabel.previousConnection) {
                                emailInput.nextConnection.connect(messageLabel.previousConnection);
                            }
                            if (messageLabel.nextConnection && textarea.previousConnection) {
                                messageLabel.nextConnection.connect(textarea.previousConnection);
                            }
                            if (textarea.nextConnection && submitButton.previousConnection) {
                                textarea.nextConnection.connect(submitButton.previousConnection);
                            }
                        } catch (e) {
                            console.log('Connection error:', e);
                        }
                        
                        workspace.render();
                        showNotification('üìù Contoh form berhasil dimuat!', 'success');
                    }, 50);
                    
                } catch (error) {
                    console.error('Error creating form blocks:', error);
                    showNotification('‚ùå Error saat membuat form', 'error');
                }
            }, 200);
        }

        // Load table example
        function loadTableExample() {
            hideQuickActions();
            workspace.clear();
            
            setTimeout(() => {
                try {
                    // Create main structure blocks
                    const docBlock = workspace.newBlock('html_document');
                    docBlock.initSvg();
                    docBlock.render();
                    docBlock.moveBy(50, 50);
                    
                    const headBlock = workspace.newBlock('html_head');
                    headBlock.initSvg();
                    headBlock.render();
                    
                    const titleBlock = workspace.newBlock('html_title');
                    titleBlock.initSvg();
                    titleBlock.render();
                    titleBlock.setFieldValue('Data Siswa', 'TEXT');
                    
                    const bodyBlock = workspace.newBlock('html_body');
                    bodyBlock.initSvg();
                    bodyBlock.render();
                    
                    const headingBlock = workspace.newBlock('html_heading');
                    headingBlock.initSvg();
                    headingBlock.render();
                    headingBlock.setFieldValue('h2', 'LEVEL');
                    headingBlock.setFieldValue('Daftar Siswa Kelas 10A', 'TEXT');
                    
                    const tableBlock = workspace.newBlock('html_table');
                    tableBlock.initSvg();
                    tableBlock.render();
                    
                    // Create table rows and cells
                    const headerRow = workspace.newBlock('html_tr');
                    headerRow.initSvg();
                    headerRow.render();
                    
                    const header1 = workspace.newBlock('html_th');
                    header1.initSvg();
                    header1.render();
                    header1.setFieldValue('No', 'TEXT');
                    
                    const header2 = workspace.newBlock('html_th');
                    header2.initSvg();
                    header2.render();
                    header2.setFieldValue('Nama', 'TEXT');
                    
                    const header3 = workspace.newBlock('html_th');
                    header3.initSvg();
                    header3.render();
                    header3.setFieldValue('Nilai', 'TEXT');
                    
                    // Data row 1
                    const dataRow1 = workspace.newBlock('html_tr');
                    dataRow1.initSvg();
                    dataRow1.render();
                    
                    const data1_1 = workspace.newBlock('html_td');
                    data1_1.initSvg();
                    data1_1.render();
                    data1_1.setFieldValue('1', 'TEXT');
                    
                    const data1_2 = workspace.newBlock('html_td');
                    data1_2.initSvg();
                    data1_2.render();
                    data1_2.setFieldValue('Ahmad Rizki', 'TEXT');
                    
                    const data1_3 = workspace.newBlock('html_td');
                    data1_3.initSvg();
                    data1_3.render();
                    data1_3.setFieldValue('85', 'TEXT');
                    
                    // Data row 2
                    const dataRow2 = workspace.newBlock('html_tr');
                    dataRow2.initSvg();
                    dataRow2.render();
                    
                    const data2_1 = workspace.newBlock('html_td');
                    data2_1.initSvg();
                    data2_1.render();
                    data2_1.setFieldValue('2', 'TEXT');
                    
                    const data2_2 = workspace.newBlock('html_td');
                    data2_2.initSvg();
                    data2_2.render();
                    data2_2.setFieldValue('Siti Nurhaliza', 'TEXT');
                    
                    const data2_3 = workspace.newBlock('html_td');
                    data2_3.initSvg();
                    data2_3.render();
                    data2_3.setFieldValue('92', 'TEXT');
                    
                    // Position all blocks
                    headBlock.moveBy(20, 100);
                    titleBlock.moveBy(40, 170);
                    bodyBlock.moveBy(20, 240);
                    headingBlock.moveBy(40, 310);
                    tableBlock.moveBy(40, 380);
                    headerRow.moveBy(60, 450);
                    header1.moveBy(80, 520);
                    header2.moveBy(80, 590);
                    header3.moveBy(80, 660);
                    dataRow1.moveBy(60, 730);
                    data1_1.moveBy(80, 800);
                    data1_2.moveBy(80, 870);
                    data1_3.moveBy(80, 940);
                    dataRow2.moveBy(60, 1010);
                    data2_1.moveBy(80, 1080);
                    data2_2.moveBy(80, 1150);
                    data2_3.moveBy(80, 1220);
                    
                    // Connect blocks with delay
                    setTimeout(() => {
                        try {
                            // Main structure connections
                            if (docBlock.getInput('CONTENT') && headBlock.previousConnection) {
                                docBlock.getInput('CONTENT').connection.connect(headBlock.previousConnection);
                            }
                            if (headBlock.getInput('CONTENT') && titleBlock.previousConnection) {
                                headBlock.getInput('CONTENT').connection.connect(titleBlock.previousConnection);
                            }
                            if (headBlock.nextConnection && bodyBlock.previousConnection) {
                                headBlock.nextConnection.connect(bodyBlock.previousConnection);
                            }
                            if (bodyBlock.getInput('CONTENT') && headingBlock.previousConnection) {
                                bodyBlock.getInput('CONTENT').connection.connect(headingBlock.previousConnection);
                            }
                            if (headingBlock.nextConnection && tableBlock.previousConnection) {
                                headingBlock.nextConnection.connect(tableBlock.previousConnection);
                            }
                            
                            // Table structure connections
                            if (tableBlock.getInput('ROWS') && headerRow.previousConnection) {
                                tableBlock.getInput('ROWS').connection.connect(headerRow.previousConnection);
                            }
                            if (headerRow.nextConnection && dataRow1.previousConnection) {
                                headerRow.nextConnection.connect(dataRow1.previousConnection);
                            }
                            if (dataRow1.nextConnection && dataRow2.previousConnection) {
                                dataRow1.nextConnection.connect(dataRow2.previousConnection);
                            }
                            
                            // Header cells connections
                            if (headerRow.getInput('CELLS') && header1.previousConnection) {
                                headerRow.getInput('CELLS').connection.connect(header1.previousConnection);
                            }
                            if (header1.nextConnection && header2.previousConnection) {
                                header1.nextConnection.connect(header2.previousConnection);
                            }
                            if (header2.nextConnection && header3.previousConnection) {
                                header2.nextConnection.connect(header3.previousConnection);
                            }
                            
                            // Data row 1 cells connections
                            if (dataRow1.getInput('CELLS') && data1_1.previousConnection) {
                                dataRow1.getInput('CELLS').connection.connect(data1_1.previousConnection);
                            }
                            if (data1_1.nextConnection && data1_2.previousConnection) {
                                data1_1.nextConnection.connect(data1_2.previousConnection);
                            }
                            if (data1_2.nextConnection && data1_3.previousConnection) {
                                data1_2.nextConnection.connect(data1_3.previousConnection);
                            }
                            
                            // Data row 2 cells connections
                            if (dataRow2.getInput('CELLS') && data2_1.previousConnection) {
                                dataRow2.getInput('CELLS').connection.connect(data2_1.previousConnection);
                            }
                            if (data2_1.nextConnection && data2_2.previousConnection) {
                                data2_1.nextConnection.connect(data2_2.previousConnection);
                            }
                            if (data2_2.nextConnection && data2_3.previousConnection) {
                                data2_2.nextConnection.connect(data2_3.previousConnection);
                            }
                        } catch (e) {
                            console.log('Connection error:', e);
                        }
                        
                        workspace.render();
                        showNotification('üìä Contoh tabel berhasil dimuat!', 'success');
                    }, 50);
                    
                } catch (error) {
                    console.error('Error creating table blocks:', error);
                    showNotification('‚ùå Error saat membuat tabel', 'error');
                }
            }, 200);
        }

        // Copy code to clipboard
        function copyCode() {
            const code = document.getElementById('codeOutput').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('üìã Kode HTML berhasil disalin!', 'success');
            }).catch(() => {
                showNotification('‚ùå Gagal menyalin kode', 'error');
            });
        }

        // Filter blocks
        function filterBlocks() {
            const searchTerm = document.getElementById('blockSearch').value.toLowerCase();
            const blockItems = document.querySelectorAll('.block-item');
            const categories = document.querySelectorAll('.block-category');
            
            blockItems.forEach(item => {
                const blockName = item.getAttribute('data-name').toLowerCase();
                const blockType = item.getAttribute('data-block').toLowerCase();
                const isMatch = blockName.includes(searchTerm) || blockType.includes(searchTerm);
                
                if (isMatch || searchTerm === '') {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            categories.forEach(category => {
                const visibleItems = category.querySelectorAll('.block-item[style="display: block"], .block-item:not([style*="display: none"])');
                if (visibleItems.length === 0 && searchTerm !== '') {
                    category.style.display = 'none';
                } else {
                    category.style.display = 'block';
                }
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification fixed top-6 right-6 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-50 max-w-sm`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-3 text-xl">‚ú®</div>
                    <div class="flex-1">
                        <div class="font-medium text-sm">${message}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            defineBlocks();
            defineGenerators();
            initBlockly();
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // ESC to close popups
                if (e.key === 'Escape') {
                    hideBlocksPopup();
                    hideQuickActions();
                    hideOutputFullscreen();
                }
                
                // Ctrl/Cmd + B to show blocks popup
                if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                    e.preventDefault();
                    showBlocksPopup();
                }
                
                // Ctrl/Cmd + R to run code
                if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                    e.preventDefault();
                    runCode();
                }
                
                // Ctrl/Cmd + Q to show quick actions
                if ((e.ctrlKey || e.metaKey) && e.key === 'q') {
                    e.preventDefault();
                    showQuickActions();
                }
            });
            
            // Click outside popup to close
            document.getElementById('blocksPopup').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideBlocksPopup();
                }
            });
            
            document.getElementById('quickActionsPopup').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideQuickActions();
                }
            });
            
            document.getElementById('outputFullscreen').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideOutputFullscreen();
                }
            });
            
            showNotification('üéâ Workspace siap digunakan! Tekan Ctrl+B untuk menambah blok.', 'success');
        });
    </script>
</body>
</html>
