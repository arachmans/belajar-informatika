<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fungsi SUMIF Excel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral with Teal Accent -->
    <!-- Application Structure Plan: A guided, single-column learning path. Starts with an introduction, explains the core concept with an interactive syntax breakdown, provides a hands-on "simulator" for practice with instant feedback, reinforces learning with a data visualization chart, and concludes with formal objectives. A new section is added for an external Excel exercise, providing a practical application beyond the web app. -->
    <!-- Visualization & Content Choices: 
        1. SUMIF Syntax -> Interactive Explainer (HTML/JS) -> Goal: Teach -> Justification: More engaging than static text.
        2. Practical Problem -> Excel Simulator (HTML/JS) -> Goal: Apply/Practice -> Justification: Provides a safe, guided environment for hands-on practice with immediate validation, which is key for learning.
        3. Data Distribution -> Bar Chart (Chart.js) -> Goal: Compare/Analyze -> Justification: Visually reinforces the SUMIF result and shows its context within the entire dataset.
        4. Objectives/Assessment -> Formatted Text (HTML) -> Goal: Inform -> Justification: Clear and direct presentation for reference material.
        5. General Cash Table Exercise -> Textual Instructions (HTML) -> Goal: Apply/Reinforce -> Justification: Provides a real-world scenario for students to apply SUMIF (or similar conditional sum) in a native Excel environment.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .syntax-item {
            transition: all 0.2s ease-in-out;
        }
        .syntax-item:hover {
            transform: scale(1.05);
            cursor: pointer;
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        .highlight-row {
            background-color: #e0f2f2; /* Light teal for highlighting */
            transition: background-color 0.3s ease;
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-800">

    <div class="container mx-auto max-w-5xl px-4 py-8 md:py-12">

        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-700 mb-2">Belajar Interaktif: Fungsi SUMIF Excel</h1>
            <p class="text-lg text-slate-600">Sebuah rencana pembelajaran berbasis proyek untuk siswa kelas 11 SMA.</p>
        </header>

        <!-- Main Content -->
        <main class="space-y-16">

            <!-- Section 1: Project Description -->
            <section id="deskripsi" class="bg-white p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">1. Deskripsi Proyek</h2>
                <p class="text-slate-700 leading-relaxed">
                    Selamat datang, Analis Data Junior! Dalam proyek ini, Anda akan diberikan sebuah dataset penjualan sederhana. Tugas Anda adalah menggunakan fungsi <b>SUMIF</b> untuk menjawab pertanyaan kunci tentang data tersebut. Tujuannya adalah agar Anda memahami cara menjumlahkan data berdasarkan kriteria tertentu secara efisien dan membuat laporan yang informatif.
                </p>
            </section>

            <!-- Section 2: Core Material -->
            <section id="materi" class="bg-white p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">2. Materi Inti: Mengenal Fungsi SUMIF</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold text-teal-700 mb-2">Apa itu SUMIF?</h3>
                        <p class="text-slate-700 leading-relaxed">
                            <b>SUMIF</b> adalah fungsi di Excel yang digunakan untuk menjumlahkan nilai dalam sebuah rentang (baris atau kolom) yang memenuhi kriteria tertentu. Fungsi ini sangat berguna untuk melakukan perhitungan bersyarat tanpa harus menjumlahkan data satu per satu secara manual.
                        </p>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-teal-700 mb-4">Sintaksis Interaktif</h3>
                        <p class="text-slate-700 leading-relaxed mb-4">Arahkan kursor (atau sentuh pada perangkat mobile) ke setiap bagian rumus di bawah untuk melihat penjelasannya.</p>
                        <div class="bg-slate-100 p-4 rounded-lg text-center">
                            <code class="text-lg md:text-xl font-mono text-slate-800 tracking-wide">
                                =SUMIF(
                                <span class="syntax-item font-bold text-blue-600 has-tooltip relative">
                                    range
                                    <span class="tooltip absolute bottom-full mb-2 w-64 bg-slate-800 text-white text-sm rounded-lg p-3 z-10 -ml-32 left-1/2">
                                        Rentang sel yang akan dievaluasi berdasarkan kriteria Anda. Contoh: <code class="text-amber-300">B2:B11</code>
                                        <svg class="absolute text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"><polygon class="fill-current" points="0,0 127.5,127.5 255,0"/></svg>
                                    </span>
                                </span>,
                                <span class="syntax-item font-bold text-purple-600 has-tooltip relative">
                                    criteria
                                    <span class="tooltip absolute bottom-full mb-2 w-64 bg-slate-800 text-white text-sm rounded-lg p-3 z-10 -ml-32 left-1/2">
                                        Kondisi yang harus dipenuhi. Bisa berupa teks, angka, atau ekspresi. Contoh: <code class="text-amber-300">"Pakaian"</code> atau <code class="text-amber-300">">100"</code>
                                        <svg class="absolute text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"><polygon class="fill-current" points="0,0 127.5,127.5 255,0"/></svg>
                                    </span>
                                </span>,
                                <span class="syntax-item font-bold text-green-600 has-tooltip relative">
                                    [sum_range]
                                     <span class="tooltip absolute bottom-full mb-2 w-64 bg-slate-800 text-white text-sm rounded-lg p-3 z-10 -ml-32 left-1/2">
                                        (Opsional) Rentang sel yang akan dijumlahkan. Jika kosong, 'range' yang akan dijumlahkan. Contoh: <code class="text-amber-300">C2:C11</code>
                                        <svg class="absolute text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"><polygon class="fill-current" points="0,0 127.5,127.5 255,0"/></svg>
                                    </span>
                                </span>)
                            </code>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Interactive Project -->
            <section id="proyek" class="bg-white p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">3. Proyek Praktik Langsung</h2>
                <p class="text-slate-700 leading-relaxed mb-6">
                    Sekarang giliran Anda untuk mencoba! Gunakan tabel data di bawah ini untuk menyelesaikan tantangan yang diberikan. Masukkan rumus SUMIF yang tepat pada kolom yang tersedia dan lihat hasilnya secara langsung.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Data Table -->
                    <div>
                        <h3 class="text-xl font-semibold mb-3">Tabel Data Penjualan</h3>
                        <div class="overflow-x-auto rounded-lg border">
                            <table class="w-full text-sm text-left text-slate-600">
                                <thead class="bg-slate-100 text-xs text-slate-700 uppercase">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Nama Barang</th>
                                        <th scope="col" class="px-6 py-3">Kategori</th>
                                        <th scope="col" class="px-6 py-3 text-right">Harga Jual</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <!-- Data will be populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Challenge -->
                    <div class="bg-teal-50 p-6 rounded-lg border border-teal-200">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-xl font-semibold">Tantangan Anda:</h3>
                            <span id="questionCounter" class="text-slate-600 font-medium">Soal 1 dari 3</span>
                        </div>
                        <p id="questionText" class="text-slate-700 mb-4"><b>Hitunglah total harga jual semua barang yang termasuk dalam kategori "Pakaian".</b></p>
                        
                        <div class="flex items-center bg-white p-2 rounded-md shadow-sm">
                            <span class="text-gray-500 font-mono text-sm px-2">fx</span>
                            <input type="text" id="formulaInput" class="w-full p-2 border-0 focus:ring-0 font-mono text-sm" placeholder="Ketik rumus SUMIF di sini...">
                        </div>
                        
                        <div class="flex gap-2 mt-4">
                            <button id="runFormulaBtn" class="flex-1 bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700 transition-colors">
                                Periksa Jawaban
                            </button>
                            <button id="clearBtn" class="flex-1 bg-gray-400 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-500 transition-colors">
                                Hapus
                            </button>
                        </div>
                        
                        <div id="resultBox" class="mt-4 p-4 rounded-lg text-center font-semibold hidden"></div>
                        
                        <button id="nextQuestionBtn" class="mt-6 w-full bg-slate-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-800 transition-colors hidden">
                            Soal Selanjutnya
                        </button>
                        <button id="showScoreBtn" class="mt-6 w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors hidden">
                            Lihat Skor Akhir
                        </button>
                    </div>
                </div>
                <div id="finalScoreSection" class="mt-8 p-6 bg-blue-100 rounded-lg shadow-inner text-center hidden">
                    <h3 class="text-2xl font-bold text-blue-800 mb-3">Skor Akhir Anda:</h3>
                    <p id="scoreDisplay" class="text-4xl font-extrabold text-blue-900">0 / 3</p>
                    <p class="text-blue-700 mt-2">Selamat! Anda telah menyelesaikan semua soal.</p>
                </div>
            </section>
            
            <!-- Section 4: Data Visualization -->
            <section id="visualisasi" class="bg-white p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">4. Visualisasi Data</h2>
                <p class="text-slate-700 leading-relaxed mb-6">
                    Untuk melihat gambaran yang lebih besar, grafik di bawah ini menunjukkan perbandingan total nilai dari setiap kategori barang. Ini membantu kita memahami bagaimana hasil perhitungan Anda dibandingkan dengan kategori lainnya.
                </p>
                <div class="chart-container relative w-full max-w-3xl mx-auto h-80 md:h-96">
                    <canvas id="categoryChart"></canvas>
                </div>
            </section>

            <!-- Section 5: Objectives & Assessment -->
            <section id="penilaian" class="bg-white p-8 rounded-xl shadow-md">
                 <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">5. Tujuan & Penilaian</h2>
                 <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold text-teal-700 mb-3">Tujuan Pembelajaran</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li>Memahami sintaksis dan cara kerja fungsi SUMIF.</li>
                            <li>Menggunakan fungsi SUMIF untuk menjumlahkan nilai berdasarkan kriteria tunggal.</li>
                            <li>Menerapkan fungsi SUMIF pada kasus nyata.</li>
                            <li>Menganalisis hasil penjumlahan data.</li>
                        </ul>
                    </div>
                     <div>
                        <h3 class="text-xl font-semibold text-teal-700 mb-3">Kriteria Penilaian Proyek</h3>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li><b>Ketetapan Rumus (70%):</b> Keberhasilan menulis rumus SUMIF dengan sintaksis yang benar.</li>
                            <li><b>Kesesuaian Jawaban (30%):</b> Hasil akhir yang ditampilkan benar dan sesuai dengan data.</li>
                        </ul>
                    </div>
                 </div>
            </section>

            <!-- Section 6: Excel Application Exercise -->
            <section id="latihan-excel" class="bg-white p-8 rounded-xl shadow-md">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2 border-teal-200">6. Latihan Aplikasi di Microsoft Excel</h2>
                <p class="text-slate-700 leading-relaxed mb-6">
                    Setelah Anda mahir dengan konsep dasar SUMIF, kini saatnya menerapkan pemahaman Anda dalam skenario yang lebih kompleks langsung di Microsoft Excel.
                </p>
                <h3 class="text-xl font-semibold text-teal-700 mb-3">Soal: Membuat Tabel Kas Umum</h3>
                <p class="text-slate-700 leading-relaxed mb-4">
                    Buatlah sebuah "Tabel Kas Umum" di Microsoft Excel dengan struktur sebagai berikut:
                </p>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4 flex items-center justify-between">
                    <span class="text-blue-800 font-semibold text-lg">Total Saldo:</span>
                    <span id="totalSaldoDisplay" class="text-blue-900 font-bold text-2xl">...</span>
                </div>

                <div class="overflow-x-auto rounded-lg border mb-6">
                    <table class="w-full text-sm text-left text-slate-600">
                        <thead class="bg-slate-100 text-xs text-slate-700 uppercase">
                            <tr>
                                <th scope="col" class="px-6 py-3">Tanggal</th>
                                <th scope="col" class="px-6 py-3">Keterangan</th>
                                <th scope="col" class="px-6 py-3">Tipe</th>
                                <th scope="col" class="px-6 py-3 text-right">Jumlah</th>
                            </tr>
                        </thead>
                        <tbody id="kasUmumTableBody">
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4">01/08/2024</td>
                                <td class="px-6 py-4">Penjualan Produk A</td>
                                <td class="px-6 py-4 kas-tipe">Debet</td>
                                <td class="px-6 py-4 text-right kas-jumlah">500000</td>
                            </tr>
                            <tr class="bg-slate-50 border-b">
                                <td class="px-6 py-4">02/08/2024</td>
                                <td class="px-6 py-4">Pembelian Bahan Baku</td>
                                <td class="px-6 py-4 kas-tipe">Kredit</td>
                                <td class="px-6 py-4 text-right kas-jumlah">200000</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4">03/08/2024</td>
                                <td class="px-6 py-4">Penjualan Produk B</td>
                                <td class="px-6 py-4 kas-tipe">Debet</td>
                                <td class="px-6 py-4 text-right kas-jumlah">350000</td>
                            </tr>
                            <tr class="bg-slate-50 border-b">
                                <td class="px-6 py-4">04/08/2024</td>
                                <td class="px-6 py-4">Biaya Operasional</td>
                                <td class="px-6 py-4 kas-tipe">Kredit</td>
                                <td class="px-6 py-4 text-right kas-jumlah">100000</td>
                            </tr>
                             <tr class="bg-white border-b">
                                <td class="px-6 py-4">05/08/2024</td>
                                <td class="px-6 py-4">Penerimaan Piutang</td>
                                <td class="px-6 py-4 kas-tipe">Debet</td>
                                <td class="px-6 py-4 text-right kas-jumlah">150000</td>
                            </tr>
                            <tr class="bg-slate-50 border-b">
                                <td class="px-6 py-4">06/08/2024</td>
                                <td class="px-6 py-4">Pembayaran Gaji Karyawan</td>
                                <td class="px-6 py-4 kas-tipe">Kredit</td>
                                <td class="px-6 py-4 text-right kas-jumlah">400000</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4">07/08/2024</td>
                                <td class="px-6 py-4">Penjualan Jasa</td>
                                <td class="px-6 py-4 kas-tipe">Debet</td>
                                <td class="px-6 py-4 text-right kas-jumlah">250000</td>
                            </tr>
                            <tr class="bg-slate-50 border-b">
                                <td class="px-6 py-4">08/08/2024</td>
                                <td class="px-6 py-4">Pembelian Perlengkapan Kantor</td>
                                <td class="px-6 py-4 kas-tipe">Kredit</td>
                                <td class="px-6 py-4 text-right kas-jumlah">75000</td>
                            </tr>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4">09/08/2024</td>
                                <td class="px-6 py-4">Penerimaan Bunga Bank</td>
                                <td class="px-6 py-4 kas-tipe">Debet</td>
                                <td class="px-6 py-4 text-right kas-jumlah">10000</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="px-6 py-4">10/08/2024</td>
                                <td class="px-6 py-4">Pembayaran Listrik & Air</td>
                                <td class="px-6 py-4 kas-tipe">Kredit</td>
                                <td class="px-6 py-4 text-right kas-jumlah">80000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-slate-700 leading-relaxed mb-4">
                    Di atas tabel, buatlah sebuah sel untuk menampilkan <b>"Total Saldo"</b>. Sel ini harus secara otomatis menghitung saldo kas saat ini.
                </p>
                <ul class="list-disc list-inside space-y-2 text-slate-700 mb-6">
                    <li>Jika tipe transaksi adalah <b>"Debet"</b>, maka jumlah akan <b>menambah</b> total saldo.</li>
                    <li>Jika tipe transaksi adalah <b>"Kredit"</b>, maka jumlah akan <b>mengurangi</b> total saldo.</li>
                    <li>Gunakan fungsi <b>SUMIF</b> (atau kombinasi fungsi lain seperti SUMIFS jika diperlukan) untuk menghitung total Debet dan total Kredit secara terpisah, kemudian hitung selisihnya untuk mendapatkan Total Saldo.</li>
                </ul>
                <p class="text-slate-700 font-semibold">
                    Tujuan dari latihan ini adalah untuk melihat bagaimana Anda dapat menggunakan fungsi bersyarat untuk mengelola data keuangan sederhana.
                </p>
            </section>

        </main>

        <!-- Footer -->
        <footer class="text-center mt-16 text-slate-500 text-sm">
            <p>Aplikasi Pembelajaran Interaktif &copy; 2024. Dibuat untuk Guru Informatika.</p>
        </footer>

    </div>

    <script>
        const data = [
            { nama: 'Buku Tulis', kategori: 'Alat Tulis', harga: 15000 },
            { nama: 'Pulpen', kategori: 'Alat Tulis', harga: 5000 },
            { nama: 'Buku Gambar', kategori: 'Alat Tulis', harga: 25000 },
            { nama: 'Ransel Eiger', kategori: 'Tas', harga: 450000 },
            { nama: 'Dompet Kulit', kategori: 'Tas', harga: 300000 },
            { nama: 'Baju Kaos', kategori: 'Pakaian', harga: 75000 },
            { nama: 'Celana Jeans', kategori: 'Pakaian', harga: 250000 },
            { nama: 'Topi Fashion', kategori: 'Aksesoris', harga: 60000 },
            { nama: 'Gelang Tangan', kategori: 'Aksesoris', harga: 30000 },
            { nama: 'Kemeja Formal', kategori: 'Pakaian', harga: 180000 },
        ];

        const currencyFormatter = new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });

        // Populate Table
        const tableBody = document.getElementById('dataTableBody');
        tableBody.innerHTML = ''; 
        data.forEach((item, index) => {
            const row = document.createElement('tr');
            row.className = `border-b ${index % 2 === 0 ? 'bg-white' : 'bg-slate-50'}`;
            row.innerHTML = `
                <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${item.nama}</td>
                <td class="px-6 py-4 category-cell">${item.kategori}</td>
                <td class="px-6 py-4 text-right">${currencyFormatter.format(item.harga)}</td>
            `;
            tableBody.appendChild(row);
        });

        // Interactive Formula Elements
        const questionCounter = document.getElementById('questionCounter');
        const questionText = document.getElementById('questionText');
        const formulaInput = document.getElementById('formulaInput');
        const runFormulaBtn = document.getElementById('runFormulaBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultBox = document.getElementById('resultBox');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const showScoreBtn = document.getElementById('showScoreBtn');
        const finalScoreSection = document.getElementById('finalScoreSection');
        const scoreDisplay = document.getElementById('scoreDisplay');

        // Define Questions
        const questions = [
            {
                text: 'Hitunglah total harga jual semua barang yang termasuk dalam kategori "Pakaian".',
                correctAnswer: 505000,
                correctFormulaParts: ['=SUMIF(', 'B2:B11', '"Pakaian"', 'C2:C11)'],
                highlightCriteria: (item) => item.kategori === 'Pakaian'
            },
            {
                text: 'Hitunglah total harga jual semua barang yang harganya kurang dari Rp 50.000.',
                correctAnswer: 75000, // 15000 + 5000 + 25000 + 30000
                correctFormulaParts: ['=SUMIF(', 'C2:C11', '"<50000"', 'C2:C11)'],
                highlightCriteria: (item) => item.harga < 50000
            },
            {
                text: 'Hitunglah total harga jual semua barang yang termasuk dalam kategori "Tas".',
                correctAnswer: 750000, // 450000 + 300000
                correctFormulaParts: ['=SUMIF(', 'B2:B11', '"Tas"', 'C2:C11)'],
                highlightCriteria: (item) => item.kategori === 'Tas'
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;

        function removeHighlights() {
            document.querySelectorAll('.highlight-row').forEach(row => {
                row.classList.remove('highlight-row');
            });
        }

        function highlightRelevantRows(criteriaFn) {
            const rows = tableBody.children;
            for (let i = 0; i < rows.length; i++) {
                if (criteriaFn(data[i])) {
                    rows[i].classList.add('highlight-row');
                }
            }
        }

        function displayQuestion() {
            if (currentQuestionIndex < questions.length) {
                const q = questions[currentQuestionIndex];
                questionText.innerHTML = `<b>${q.text}</b>`;
                questionCounter.textContent = `Soal ${currentQuestionIndex + 1} dari ${questions.length}`;
                formulaInput.value = '';
                resultBox.classList.add('hidden');
                resultBox.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
                removeHighlights();
                runFormulaBtn.disabled = false;
                nextQuestionBtn.classList.add('hidden');
                showScoreBtn.classList.add('hidden');
                finalScoreSection.classList.add('hidden');
            } else {
                showFinalScore();
            }
        }

        function showFinalScore() {
            finalScoreSection.classList.remove('hidden');
            scoreDisplay.textContent = `${score} / ${questions.length}`;
            runFormulaBtn.classList.add('hidden');
            clearBtn.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            showScoreBtn.classList.add('hidden');
            formulaInput.disabled = true;
            resultBox.classList.add('hidden');
            questionText.classList.add('hidden');
            questionCounter.classList.add('hidden');
        }

        runFormulaBtn.addEventListener('click', () => {
            const currentQ = questions[currentQuestionIndex];
            const userInput = formulaInput.value.toLowerCase().replace(/\s/g, '');
            
            let isCorrectFormula = true;
            for (const part of currentQ.correctFormulaParts) {
                if (!userInput.includes(part.toLowerCase().replace(/\s/g, ''))) {
                    isCorrectFormula = false;
                    break;
                }
            }

            resultBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            removeHighlights();

            if (isCorrectFormula) {
                resultBox.classList.add('bg-green-100', 'text-green-800');
                resultBox.innerHTML = `Benar! Hasilnya adalah ${currencyFormatter.format(currentQ.correctAnswer)}`;
                highlightRelevantRows(currentQ.highlightCriteria);
                score++;
                runFormulaBtn.disabled = true;
                if (currentQuestionIndex < questions.length - 1) {
                    nextQuestionBtn.classList.remove('hidden');
                } else {
                    showScoreBtn.classList.remove('hidden');
                }
            } else {
                resultBox.classList.add('bg-red-100', 'text-red-800');
                resultBox.innerHTML = 'Kurang tepat. Periksa kembali rumus, rentang, dan kriteria Anda!';
            }
            resultBox.classList.remove('hidden');
        });

        clearBtn.addEventListener('click', () => {
            formulaInput.value = '';
            resultBox.classList.add('hidden');
            resultBox.classList.remove('bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            removeHighlights();
        });

        nextQuestionBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            displayQuestion();
        });

        showScoreBtn.addEventListener('click', () => {
            showFinalScore();
        });

        // Chart.js Visualization
        const categories = [...new Set(data.map(item => item.kategori))];
        const categoryTotals = categories.map(category => {
            return data
                .filter(item => item.kategori === category)
                .reduce((sum, item) => sum + item.harga, 0);
        });

        const ctx = document.getElementById('categoryChart').getContext('2d');
        if (window.categoryChartInstance) {
            window.categoryChartInstance.destroy();
        }
        window.categoryChartInstance = new Chart(ctx, { 
            type: 'bar',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Total Harga Jual per Kategori',
                    data: categoryTotals,
                    backgroundColor: [
                        'rgba(13, 148, 136, 0.6)', // teal-600
                        'rgba(2, 132, 199, 0.6)', // sky-600
                        'rgba(249, 115, 22, 0.6)',  // orange-500
                        'rgba(168, 85, 247, 0.6)' // purple-400
                    ],
                    borderColor: [
                        'rgba(13, 148, 136, 1)',
                        'rgba(2, 132, 199, 1)',
                        'rgba(249, 115, 22, 1)',
                        'rgba(168, 85, 247, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value, index, values) {
                                return 'Rp ' + (value / 1000000) + ' Jt';
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += currencyFormatter.format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                }
            }
        });

        // Calculate and display Total Saldo for Kas Umum Table
        // This function is now commented out as per user request to display "..."
        // function calculateKasUmumSaldo() {
        //     const kasUmumTableBody = document.getElementById('kasUmumTableBody');
        //     let totalSaldo = 0;
        //     for (let i = 0; i < kasUmumTableBody.children.length; i++) {
        //         const row = kasUmumTableBody.children[i];
        //         const tipeCell = row.querySelector('.kas-tipe');
        //         const jumlahCell = row.querySelector('.kas-jumlah');
        //         const tipe = tipeCell.textContent.trim();
        //         const jumlah = parseFloat(jumlahCell.textContent.trim()); 

        //         if (tipe === 'Debet') {
        //             totalSaldo += jumlah;
        //         } else if (tipe === 'Kredit') {
        //             totalSaldo -= jumlah;
        //         }
        //     }
        //     document.getElementById('totalSaldoDisplay').textContent = currencyFormatter.format(totalSaldo);
        // }

        // Initial display
        displayQuestion();
        // calculateKasUmumSaldo(); // Removed call to hide actual saldo
    </script>
</body>
</html>
